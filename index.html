<!DOCTYPE html>
<html lang="ko">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>ê¸€ì“°ê¸° ë‚˜ì¹¨ë°˜</title>
   <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
   <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
   <link href="style.css" rel="stylesheet">
</head>
<body>
    <body class="bg-gray-50">
       <div class="container mx-auto px-4">
       <div class="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-6 no-print">
           <div class="title-container">
               <h1 class="main-title">ê¸€ì“°ê¸° ë‚˜ì¹¨ë°˜</h1>
               <p class="subtitle">ì´ˆë“± ê¸€ì“°ê¸° ëŠ¥ë ¥ í–¥ìƒì„ ìœ„í•œ ë§ì¶¤í˜• ë¶„ì„ ë„ìš°ë¯¸</p>
           </div>
           <div class="input-grid mb-4">
               <input type="text" id="grade" placeholder="í•™ë…„" class="border p-2 sm:p-3 rounded text-lg w-full">
               <input type="text" id="class" placeholder="ë°˜" class="border p-2 sm:p-3 rounded text-lg w-full">
               <input type="text" id="number" placeholder="ë²ˆí˜¸" class="border p-2 sm:p-3 rounded text-lg w-full">
               <input type="text" id="name" placeholder="ì´ë¦„" class="border p-2 sm:p-3 rounded text-lg w-full">
           </div>
           <input type="text" id="title" placeholder="ì œëª©" class="border p-2 sm:p-3 rounded w-full mb-4 text-lg">
           <div class="guide-container">
               <div class="writing-guide">
                   <div class="guide-title">
                       <span class="guide-icon">âœï¸</span>
                       ì¢‹ì€ ê¸€ì“°ê¸° ë„ì›€ë§
                   </div>
                   <ul class="guide-tips">
                       <li>â€¢ í•œ ë¬¸ë‹¨ì€ 3~5ê°œì˜ ë¬¸ì¥ìœ¼ë¡œ êµ¬ì„±í•´ìš”</li>
                       <li>â€¢ ìƒˆë¡œìš´ ë‚´ìš©ì´ ì‹œì‘ë˜ë©´ ë¬¸ë‹¨ì„ ë‚˜ëˆ ìš”</li>
                       <li>â€¢ ë¬¸ë‹¨ì˜ ì²« ë¬¸ì¥ì— ì¤‘ì‹¬ ë‚´ìš©ì„ ë‹´ì•„ìš”</li>
                   </ul>
               </div>
               <div class="writing-guide">
                   <div class="guide-title">
                       <span class="guide-icon">ğŸ“</span>
                       ê¸€ì“°ê¸° ë‚˜ì¹¨ë°˜ ì‚¬ìš©ë°©ë²•
                   </div>
                   <ul class="guide-tips">
                       <li>â€¢ ê¸€ì„ ì‘ì„±í•œ í›„ ë¬¸ë‹¨ ì œì•ˆí•˜ê¸°ë¥¼ ëˆŒëŸ¬ ë¬¸ë‹¨ ë‚˜ëˆ„ê¸° ë„ì›€ì„ ë°›ì•„ìš”</li>
                       <li>â€¢ ë„ì›€ë§ì„ ì°¸ê³ í•˜ì—¬ ë¬¸ë‹¨ì„ ë‚˜ëˆˆ ë’¤ ë¶„ì„í•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ìš”</li>
                       <li>â€¢ ìì„¸í•œ ë¶„ì„ ê²°ê³¼ì™€ ì œì•ˆì„ í™•ì¸í•˜ê³  ê¸€ì„ ìˆ˜ì •í•´ë³´ì„¸ìš”</li>
                   </ul>
               </div>
           </div>
               <!-- ë¬¸ë‹¨ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
               <div class="paragraph-controls">
                   <button class="paragraph-button suggestion-button" onclick="getParagraphSuggestions()">
                       <span>ë¬¸ë‹¨ ì œì•ˆí•˜ê¸°</span>
                       <span class="button-icon">ğŸ’¡</span>
                   </button>
                   <button class="paragraph-button preview-button" onclick="toggleParagraphPreview()">
                       <span>ë¬¸ë‹¨ ë¯¸ë¦¬ë³´ê¸°</span>
                       <span class="button-icon">ğŸ‘ï¸</span>
                   </button>
               </div>

               <div id="previewContent" class="preview-content hidden"></div>
               <!-- ë¶„ì„ ê²°ê³¼ë¥¼ í‘œì‹œí•  ì»¨í…Œì´ë„ˆ -->
               <div id="analysisResult" class="analysis-container hidden"></div>
               <div class="text-area-wrapper">
                   <textarea 
                       id="content" 
                       placeholder="ì´ê³³ì— ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”. 
           ë¬¸ë‹¨ì„ ë‚˜ëˆ„ê³  ì‹¶ì„ ë•ŒëŠ” Enterí‚¤ë¥¼ í•œ ë²ˆ ëˆŒëŸ¬ì£¼ì„¸ìš”." 
                       class="border p-2 sm:p-3 rounded w-full h-64 text-lg"
                   ></textarea>
                   <div class="paragraph-suggestions"></div>
               </div>
               <div class="writing-feedback">
                   <div class="char-count">
                       <span>ê¸€ììˆ˜: 0ì</span>
                   </div>
                   <div class="paragraph-count">
                       <span>ë¬¸ë‹¨ìˆ˜: 0ê°œ</span>
                   </div>
                   <div class="paragraph-analysis">
                       <span>ë¬¸ë‹¨ ë¶„ì„: ì ì ˆí•œ ë¬¸ë‹¨ êµ¬ë¶„ì´ í•„ìš”í•´ìš”</span>
                   </div>
               </div>
           </div>

           <div class="button-and-credits">
               <button id="submitBtn" class="bg-blue-500 text-white px-4 sm:px-6 py-2 sm:py-3 rounded text-lg font-medium hover:bg-blue-600 w-full sm:w-auto">
                   ë¶„ì„í•˜ê¸°
               </button>
               <div class="credits text-gray-500 text-sm flex items-center">
                   Created by B.S.Park. Powered by GPT 4o-mini.
               </div>
           </div>
       </div>

        <div id="result" class="container mx-auto px-4 hidden">
           <!-- ë¶„ì„ ê²°ê³¼ í…œí”Œë¦¿ -->
           <script type="text/template" id="analysisTemplate">
               <!-- ì²« ë²ˆì§¸ í˜ì´ì§€ ì‹œì‘ -->
               <div class="bg-white rounded-lg shadow-lg p-4 sm:p-8 mb-6 print-page page-1">
                   <div class="result-title-container">
                       <div class="result-title">ê¸€ì“°ê¸° í‰ê°€ ê²°ê³¼</div>
                       <div class="result-date">${new Date().toLocaleDateString('ko-KR')} ë¶„ì„</div>
                   </div>

                   <div class="student-info-grid">
                       <div class="student-info-item">í•™ë…„: ${essayData.grade}</div>
                       <div class="student-info-item">ë°˜: ${essayData.class}</div>
                       <div class="student-info-item">ë²ˆí˜¸: ${essayData.number}</div>
                       <div class="student-info-item">ì´ë¦„: ${essayData.name}</div>
                   </div>

                   <div class="flex flex-col gap-8 p-6">
                       <div class="flex items-center gap-6">
                           <div class="flex items-center">
                               <div class="bg-blue-100 rounded-full w-24 h-24 flex items-center justify-center">
                                   <span class="text-blue-600 text-4xl font-bold">${score}ì </span>
                               </div>
                           </div>
                           <div class="h-20 w-px bg-gray-200 mx-4"></div>
                           <p class="text-gray-700 text-lg flex-1">${totalEvaluation}</p>
                       </div>

                       <div class="flex gap-12">
                           <div class="w-[400px] flex-shrink-0">
                               ${createRadarChart(Object.entries(scores).map(([name, data]) => ({
                                   name,
                                   grade: data.grade
                               })))}
                           </div>

                           <div class="flex flex-col flex-1 gap-6">
                               <div class="grid grid-cols-2 gap-4">
                                   ${Object.entries(categories).map(([category, description]) => {
                                       const data = scores[category];
                                       return `
                                           <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between gap-4">
                                               <div>
                                                   <div class="text-lg font-medium text-gray-900">${category}</div>
                                                   <div class="text-sm text-gray-500">${description}</div>
                                               </div>
                                               <div class="grade-badge ${getGradeStyle(data.grade)}">
                                                   ${data.grade}
                                               </div>
                                           </div>
                                       `;
                                   }).join('')}
                               </div>

                               <div class="grid grid-cols-4 gap-3">
                                   <div class="bg-gray-50 p-6 rounded-lg text-center h-28 flex flex-col justify-center">
                                       <div class="text-base text-gray-500">ì´ ê¸€ì ìˆ˜</div>
                                       <div class="text-2xl font-bold text-blue-600">${statistics.charCount}ì</div>
                                   </div>
                                   <div class="bg-gray-50 p-6 rounded-lg text-center h-28 flex flex-col justify-center">
                                       <div class="text-base text-gray-500">ì´ ë¬¸ì¥ ìˆ˜</div>
                                       <div class="text-2xl font-bold text-blue-600">${statistics.sentenceCount}ê°œ</div>
                                   </div>
                                   <div class="bg-gray-50 p-6 rounded-lg text-center h-28 flex flex-col justify-center">
                                       <div class="text-base text-gray-500">ì´ ë¬¸ë‹¨ ìˆ˜</div>
                                       <div class="text-2xl font-bold text-blue-600">${statistics.paragraphCount}ê°œ</div>
                                   </div>
                                   <div class="bg-gray-50 p-6 rounded-lg text-center h-28 flex flex-col justify-center">
                                       <div class="text-base text-gray-500">í‰ê·  ë¬¸ì¥ ê¸¸ì´</div>
                                       <div class="text-2xl font-bold text-blue-600">${statistics.avgSentenceLength}ì</div>
                                   </div>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
               <!-- ì²« ë²ˆì§¸ í˜ì´ì§€ ë -->
               <!-- ë‘ ë²ˆì§¸ í˜ì´ì§€ ì‹œì‘ -->
               <div class="bg-white rounded-lg shadow-lg p-4 sm:p-8 mb-6 print-page page-2">
                   <h2 class="section-title">ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ</h2>
                   <div class="structure-content">
                       <div class="structure-box">
                           <div class="structure-box-title">í˜„ì¬ ë¬¸ë‹¨ êµ¬ì¡°</div>
                           ${formatStructureContent(currentStructure, 'current')}
                       </div>
                       <div class="structure-box">
                           <div class="structure-box-title">ë¬¸ë‹¨ êµ¬ì„± ê°œì„ ì•ˆ</div>
                           ${formatStructureContent(improvedStructure, 'improved')}
                       </div>
                       <div class="structure-box">
                           <div class="structure-box-title">êµ¬ì²´ì  ì‹¤í–‰ ë°©ì•ˆ</div>
                           ${formatStructureContent(structureSuggestions, 'suggestions')}
                       </div>
                   </div>
               </div>
              <!-- ë‘ ë²ˆì§¸ í˜ì´ì§€ ë -->
               <!-- ë‘ ë²ˆì§¸ í˜ì´ì§€ ì‹œì‘ -->
               <div class="bg-white rounded-lg shadow-lg p-4 sm:p-8 mb-6 print-page page-2">
                   <h2 class="section-title">ì˜ì—­ë³„ ë¶„ì„</h2>
                   <div class="category-grid">
                       ${Object.entries(scores).map(([category, data]) => `
                           <div class="analysis-category-section">
                               <div class="category-header">
                                   <div class="category-title-wrap">
                                       <div class="category-name">${category}</div>
                                       <div class="category-subtitle">${categories[category]}</div>
                                   </div>
                                   <div class="category-grade ${getGradeStyle(data.grade)}">
                                       ${data.grade}
                                   </div>
                               </div>
                               <div class="feedback-grid">
                                   <div class="feedback-box analysis">
                                       <div class="feedback-title analysis">í‰ê°€</div>
                                       <div class="feedback-content">${data.evaluation}</div>
                                   </div>
                                   <div class="feedback-box good-points">
                                       <div class="feedback-title good-points">ì˜ëœ ì </div>
                                       <div class="feedback-content">${data.goodPoints}</div>
                                   </div>
                                   <div class="feedback-box improvements">
                                       <div class="feedback-title improvements">ê°œì„ ì </div>
                                       <div class="feedback-content">${data.improvements}</div>
                                   </div>
                               </div>
                           </div>
                       `).join('')}
                   </div>
               </div>
               <!-- ë‘ ë²ˆì§¸ í˜ì´ì§€ ë -->

               <!-- ì„¸ ë²ˆì§¸ í˜ì´ì§€ ì‹œì‘ -->
               <div class="bg-white rounded-lg shadow-lg p-4 sm:p-8 mb-6 print-page page-3">
                   <!-- ì œëª© ë¶„ì„ ì„¹ì…˜ -->
                   <div class="analysis-category-section">
                       <div class="category-header">
                           <div class="category-title-wrap">
                               <div class="category-name">ì œëª© ë¶„ì„</div>
                               <div class="category-subtitle">ì œëª©ì˜ ëª…í™•ì„±ê³¼ ë‚´ìš© ì—°ê´€ì„±</div>
                           </div>
                           <div class="category-grade ${getGradeStyle(titleData.grade)}">
                               ${titleData.grade}
                           </div>
                       </div>
                       <div class="feedback-grid">
                           <div class="feedback-box analysis">
                               <div class="feedback-title analysis">í˜„ì¬ ì œëª©</div>
                               <div class="feedback-content">${titleData.current}</div>
                           </div>
                           <div class="feedback-box good-points">
                               <div class="feedback-title good-points">ë¶„ì„</div>
                               <div class="feedback-content">${titleData.analysis}</div>
                           </div>
                           <div class="feedback-box improvements">
                               <div class="feedback-title improvements">ì œì•ˆ</div>
                               <div class="feedback-content">${titleData.suggestions.join('\n')}</div>
                           </div>
                       </div>
                   </div>

                   <!-- ë¬¸ë‹¨ë³„ ìƒì„¸ ë¶„ì„ ì„¹ì…˜ -->
                   <h2 class="section-title">ë¬¸ë‹¨ë³„ ìƒì„¸ ë¶„ì„</h2>

                   <!-- ë¬¸ë‹¨ë“¤ì„ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ -->
                   <div class="paragraphs-container">
                       ${paragraphs.map(function(paragraph) {
                           return `
                           <div class="paragraph-section">
                               <div class="paragraph-header">
                                   <h4 class="paragraph-title">${paragraph.index}ë²ˆì§¸ ë¬¸ë‹¨</h4>
                               </div>
                               <div class="original-text">${paragraph.content}</div>
                               <div class="paragraph-analysis">
                                   <div class="analysis-type analysis">
                                       <div class="analysis-type-header">ë¶„ì„</div>
                                       <div class="analysis-content">${paragraph.analysis}</div>
                                   </div>
                                   <div class="analysis-type good-points">
                                       <div class="analysis-type-header">ì˜ëœ ì </div>
                                       <div class="analysis-content">${paragraph.goodPoints}</div>
                                   </div>
                                   <div class="analysis-type improvements">
                                       <div class="analysis-type-header">ê°œì„ ì </div>
                                       <div class="analysis-content">${paragraph.improvements}</div>
                                   </div>
                               </div>
                               ${paragraph.suggestions.length > 0 ? `
                                   <div class="suggestion-box">
                                       <div class="suggestion-title">í‘œí˜„ ê°œì„  ì œì•ˆ</div>
                                       <ul class="suggestion-list">
                                           ${paragraph.suggestions.map(function(suggestion) {
                                               return `<li class="suggestion-item">${suggestion}</li>`;
                                           }).join('')}
                                       </ul>
                                   </div>
                               ` : ''}
                           </div>
                           `;
                       }).join('')}
                   </div>
                   <!-- ë¬¸ë‹¨ë³„ ìƒì„¸ ë¶„ì„ ì„¹ì…˜ ë -->

                   <!-- ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ ì„¹ì…˜ -->
                   <h2 class="section-title">ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ</h2>
                   <div class="structure-content">
                       <div class="structure-box">
                           <div class="structure-box-title">í˜„ì¬ ë¬¸ë‹¨ êµ¬ì¡°</div>
                           <div class="structure-list">
                               ${formatStructureContent(currentStructure)}
                           </div>
                       </div>
                       <div class="structure-box">
                           <div class="structure-box-title">ë¬¸ë‹¨ êµ¬ì„± ê°œì„ ì•ˆ</div>
                           <div class="structure-list">
                               ${formatStructureContent(improvedStructure, 'improved')}
                           </div>
                       </div>
                       <div class="structure-box">
                           <div class="structure-box-title">êµ¬ì²´ì  ì‹¤í–‰ ë°©ì•ˆ</div>
                           <div class="structure-list">
                               ${formatStructureContent(structureSuggestions)}
                           </div>
                       </div>
                   </div>
               </div>
               <!-- ì„¸ ë²ˆì§¸ í˜ì´ì§€ ë -->

               <div class="print-button-container no-print">
                   <button onclick="window.print()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                       í”„ë¦°íŠ¸í•˜ê¸°
                   </button>
               </div>
           </script>
       </div>


     <script>
        function countCharacters(text) {
            if (!text) return 0;
            // ì¤„ë°”ê¿ˆë§Œ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ ê³µë°±ì€ í¬í•¨
            return text.replace(/\n/g, '').length;
        }

         function calculateTotalScore(scores, titleData) {
             console.log('calculateTotalScore í˜¸ì¶œë¨');
             console.log('ì „ë‹¬ë°›ì€ titleData:', titleData);

             const gradePoints = {
                 'A+': 100,
                 'A': 90,
                 'B+': 80,
                 'B': 70,
                 'C+': 60,
                 'C': 50,
                 'D+': 40,
                 'D': 35,
                 'F': 30
             };

             const weights = {
                 'ë…¼ë¦¬ì„±': 0.30,
                 'êµ¬ì¡°ì„±': 0.25,
                 'í‘œí˜„ì„±': 0.20,
                 'ì™„ì„±ë„': 0.15,
                 'ì œëª©': 0.10
             };

             let totalScore = 0;

             // ê¸°ì¡´ ì ìˆ˜ ê³„ì‚°
             Object.entries(scores).forEach(([category, data]) => {
                 const gradePoint = gradePoints[data.grade] || 50;
                 const weightedScore = gradePoint * weights[category];
                 console.log(`${category}: ${data.grade} (${gradePoint}) Ã— ${weights[category]} = ${weightedScore}`);
                 totalScore += weightedScore;
             });

             // ì œëª© ì ìˆ˜ ê³„ì‚°
             if (titleData && titleData.grade) {
                 const titleGradePoint = gradePoints[titleData.grade] || 50;
                 const titleWeightedScore = titleGradePoint * weights['ì œëª©'];
                 console.log(`ì œëª©: ${titleData.grade} (${titleGradePoint}) Ã— ${weights['ì œëª©']} = ${titleWeightedScore}`);
                 totalScore += titleWeightedScore;
             }

             return Math.ceil(totalScore);
         }

        function extractScore(analysis, category) {
            try {
                const sectionRegex = new RegExp(`\\[${category}\\][^]*?(?=\\[|#|$)`);
                const section = analysis.match(sectionRegex)?.[0] || '';
                const gradeMatch = section.match(/ë“±ê¸‰:\s*([A-F][+]?)/);
                return {
                    grade: gradeMatch ? gradeMatch[1] : 'F'
                };
            } catch (error) {
                console.error(`Error extracting score for ${category}:`, error);
                return { grade: 'F' };
            }
        }

         // ì ìˆ˜ ê²€ì¦ í•¨ìˆ˜ ì¶”ê°€
         function validateScores(scores, paragraphCount) {
             if (paragraphCount <= 1) {
                 // í•œ ë¬¸ë‹¨ì¼ ê²½ìš° ì ìˆ˜ë¥¼ ê°•ì œë¡œ ì¡°ì •
                 console.log('í•œ ë¬¸ë‹¨ ê²€ì¶œ: ì ìˆ˜ ê°•ì œ ì¡°ì •');

                 // êµ¬ì¡°ì„± ì ìˆ˜ëŠ” D+ ì´í•˜ë¡œ ê°•ì œ
                 if (['A+', 'A', 'B+', 'B', 'C+', 'C', 'D+'].includes(scores['êµ¬ì¡°ì„±'].grade)) {
                     scores['êµ¬ì¡°ì„±'].grade = 'D';
                 }

                 // ì™„ì„±ë„ ì ìˆ˜ëŠ” C+ ì´í•˜ë¡œ ê°•ì œ
                 if (['A+', 'A', 'B+', 'B'].includes(scores['ì™„ì„±ë„'].grade)) {
                     scores['ì™„ì„±ë„'].grade = 'C';
                 }

                 console.log('ì¡°ì •ëœ ì ìˆ˜:', {
                     'êµ¬ì¡°ì„±': scores['êµ¬ì¡°ì„±'].grade,
                     'ì™„ì„±ë„': scores['ì™„ì„±ë„'].grade
                 });
             }
             return scores;
         }

        function createRadarChart(categories) {
            const size = 550;
            const center = size / 2;
            const radius = size * 0.35;
            const pointCount = categories.length;
            const angleStep = (Math.PI * 2) / pointCount;

            let points = categories.map((cat, i) => {
                const angle = i * angleStep - Math.PI / 2;
                const value = convertGradeToValue(cat.grade);
                const x = center + radius * value * Math.cos(angle);
                const y = center + radius * value * Math.sin(angle);
                return { x, y };
            });

            let pathData = points.map((p, i) => 
                (i === 0 ? 'M' : 'L') + `${p.x},${p.y}`
            ).join(' ') + 'Z';

            return `
                <svg viewBox="0 0 ${size} ${size}" class="radar-chart" style="overflow: visible;">
                    ${[0.2, 0.4, 0.6, 0.8, 1].map(r => `
                        <circle 
                            cx="${center}" 
                            cy="${center}" 
                            r="${radius * r}" 
                            fill="none" 
                            stroke="#e5e7eb" 
                            stroke-width="2"
                        />
                    `).join('')}

                    ${categories.map((_, i) => {
                        const angle = i * angleStep - Math.PI / 2;
                        return `
                            <line 
                                x1="${center}" 
                                y1="${center}" 
                                x2="${center + radius * Math.cos(angle)}" 
                                y2="${center + radius * Math.sin(angle)}" 
                                stroke="#e5e7eb" 
                                stroke-width="2"
                            />
                        `;
                    }).join('')}

                    <path 
                        d="${pathData}" 
                        fill="rgba(147, 197, 253, 0.3)" 
                        stroke="#3b82f6" 
                        stroke-width="3"
                    />

                    ${categories.map((cat, i) => {
                                       const angle = i * angleStep - Math.PI / 2;
                                       const x = center + (radius + 50) * Math.cos(angle);  // 40ì—ì„œ 50ìœ¼ë¡œ ì¦ê°€
                                       const y = center + (radius + 50) * Math.sin(angle);
                                       return `
                                           <text 
                                               x="${x}" 
                                               y="${y}" 
                                               text-anchor="middle" 
                                               dominant-baseline="middle"
                                               class="text-lg font-medium"
                                               style="font-size: 22px; font-weight: 600;"  // ê¸€ì í¬ê¸°ì™€ ë‘ê»˜ ì§ì ‘ ì§€ì •
                                           >${cat.name}</text>
                                       `;
                                   }).join('')}
                               </svg>
                           `;
                       }

        function convertGradeToValue(grade) {
            const gradeValues = {
                'A+': 1.0, 'A': 0.9,
                'B+': 0.8, 'B': 0.7,
                'C+': 0.6, 'C': 0.5,
                'D+': 0.4, 'D': 0.3,
                'F': 0.2
            };
            return gradeValues[grade] || 0.2;
        }
        // getParagraphSuggestions í•¨ìˆ˜ ì¶”ê°€
             async function getParagraphSuggestions() {
                 const content = document.getElementById('content').value.trim();
                 if (!content) {
                     alert('ê¸€ì„ ì‘ì„±í•œ í›„ì— ë¬¸ë‹¨ ì œì•ˆì„ ë°›ì•„ë³´ì„¸ìš”.');
                     return;
                 }

                 const suggestionButton = document.querySelector('.suggestion-button');
                 suggestionButton.disabled = true;
                 suggestionButton.innerHTML = '<span>ì œì•ˆë°›ëŠ” ì¤‘...</span>';

                 try {
                     const response = await fetch('/.netlify/functions/paragraphSuggestions', {
                         method: 'POST',
                         headers: {
                             'Content-Type': 'application/json',
                         },
                         body: JSON.stringify({ content })
                     });

                     if (!response.ok) {
                         throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
                     }

                     const data = await response.json();
                     displayParagraphSplits(data.paragraphs);
                 } catch (error) {
                     console.error('ë¬¸ë‹¨ ì œì•ˆ ì˜¤ë¥˜:', error);
                     alert('ë¬¸ë‹¨ ì œì•ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                 } finally {
                     suggestionButton.disabled = false;
                     suggestionButton.innerHTML = '<span>ë¬¸ë‹¨ ì œì•ˆí•˜ê¸°</span><span class="button-icon">ğŸ’¡</span>';
                 }
             }


        // ë¬¸ë‹¨ ë¶„í•  í‘œì‹œ í•¨ìˆ˜
       function displayParagraphSplits(paragraphs) {
           const previewContent = document.getElementById('previewContent');
           const previewButton = document.querySelector('.preview-button');
           previewContent.innerHTML = '';

           paragraphs.forEach((para, index) => {
               const paraElement = document.createElement('div');
               paraElement.classList.add('paragraph-split');
               paraElement.innerHTML = `
                   <div class="paragraph-text"><strong>${index + 1}ë¬¸ë‹¨:</strong> ${para.text}</div>
                   <div class="paragraph-reason"><em>ì´ë ‡ê²Œ ë‚˜ëˆˆ ì´ìœ :</em> ${para.reason}</div>
               `;
               previewContent.appendChild(paraElement);
           });

           previewContent.classList.remove('hidden');
           previewButton.innerHTML = '<span>ë¬¸ë‹¨ ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸°</span><span class="button-icon">ğŸ‘ï¸</span>';
       }

       // ë¬¸ë‹¨ ë¯¸ë¦¬ë³´ê¸° í† ê¸€ í•¨ìˆ˜
       function toggleParagraphPreview() {
           const previewContent = document.getElementById('previewContent');
           const previewButton = document.querySelector('.preview-button');
           if (previewContent.classList.contains('hidden')) {
               previewContent.classList.remove('hidden');
               previewButton.innerHTML = '<span>ë¬¸ë‹¨ ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸°</span><span class="button-icon">ğŸ‘ï¸</span>';
           } else {
               previewContent.classList.add('hidden');
               previewButton.innerHTML = '<span>ë¬¸ë‹¨ ë¯¸ë¦¬ë³´ê¸°</span><span class="button-icon">ğŸ‘ï¸</span>';
           }
       }


            function displayParagraphSuggestions(suggestions) {
                // ë¶ˆí•„ìš”í•œ ê¸°í˜¸ ì œê±°
                let cleanedSuggestions = suggestions.replace(/[#!*>_~`-]/g, '').trim();

                // ë²ˆí˜¸ íŒ¨í„´ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ë‹µ ë¶„í•  (ì˜ˆ: 1) ë‚´ìš©)
                const suggestionItems = cleanedSuggestions.split(/\d+\)\s/).filter(item => item.trim() !== '');

                // ì œì•ˆ ë‚´ìš©ì´ ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
                if (suggestionItems.length === 0) {
                    suggestionItems.push('ì œì•ˆëœ ë¬¸ë‹¨ êµ¬ì„±ì´ ì—†ìŠµë‹ˆë‹¤.');
                }

                // ì œì•ˆ ë‚´ìš©ì„ í‘œì‹œí•  ì»¨í…Œì´ë„ˆë¥¼ ì°¾ê±°ë‚˜ ìƒì„±
                let suggestionContainer = document.getElementById('paragraphSuggestionContainer');
                if (!suggestionContainer) {
                    suggestionContainer = document.createElement('div');
                    suggestionContainer.id = 'paragraphSuggestionContainer';
                    suggestionContainer.className = 'paragraph-suggestions-container';
                    // ì ì ˆí•œ ìœ„ì¹˜ì— ì»¨í…Œì´ë„ˆ ì¶”ê°€
                    const textareaContainer = document.querySelector('.textarea-container');
                    textareaContainer.parentNode.insertBefore(suggestionContainer, textareaContainer.nextSibling);
                }

                // ì œì•ˆ ë‚´ìš©ì„ ì»¨í…Œì´ë„ˆì— ì‚½ì…
                suggestionContainer.innerHTML = `
                    <h3 class="suggestion-title">ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ</h3>
                    <div class="suggestion-cards">
                        ${suggestionItems.map((item, index) => `
                            <div class="suggestion-card">
                                <div class="suggestion-number">${index + 1}ë²ˆì§¸ ë¬¸ë‹¨</div>
                                <div class="suggestion-text">${item.trim()}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

        function displayParagraphDescriptions(descriptions) {
            // ì œì•ˆ ë‚´ìš©ì„ í‘œì‹œí•  ì»¨í…Œì´ë„ˆë¥¼ ì°¾ê±°ë‚˜ ìƒì„±
            let suggestionContainer = document.getElementById('paragraphSuggestionContainer');
            if (!suggestionContainer) {
                suggestionContainer = document.createElement('div');
                suggestionContainer.id = 'paragraphSuggestionContainer';
                suggestionContainer.className = 'paragraph-suggestions-container';
                // ì ì ˆí•œ ìœ„ì¹˜ì— ì»¨í…Œì´ë„ˆ ì¶”ê°€
                const contentContainer = document.getElementById('contentWithBreaks');
                contentContainer.parentNode.insertBefore(suggestionContainer, contentContainer.nextSibling);
            }

            // ì œì•ˆ ë‚´ìš©ì„ ì»¨í…Œì´ë„ˆì— ì‚½ì…
            suggestionContainer.innerHTML = `
                <h3 class="suggestion-title">ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ</h3>
                <div class="suggestion-cards">
                    ${descriptions.map((item, index) => `
                        <div class="suggestion-card">
                            <div class="suggestion-number">${index + 1}ë²ˆì§¸ ë¬¸ë‹¨</div>
                            <div class="suggestion-text">${item.trim()}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }


        function displayParagraphBreaks(breakPositions, content) {
            // ê¸€ì ì¸ë±ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê¸€ì„ ë¶„í• í•˜ê³ , ë¬¸ë‹¨ ë¶„í•  ìœ„ì¹˜ì— í‘œì‹œ ì¶”ê°€
            let highlightedContent = '';
            let lastIndex = 0;

            for (let i = 0; i <= breakPositions.length; i++) {
                let endIndex = breakPositions[i] || content.length;
                let paragraphText = content.substring(lastIndex, endIndex);

                // ë¬¸ë‹¨ ë¶„í•  í‘œì‹œ ì¶”ê°€ (ì˜ˆ: ë¬¸ë‹¨ ëì— ì„  ì¶”ê°€)
                highlightedContent += `<div class="paragraph-suggestion">${paragraphText}</div>`;

                lastIndex = endIndex;
            }

            // ê²°ê³¼ë¥¼ í‘œì‹œí•  ì»¨í…Œì´ë„ˆì— ì‚½ì…
            let contentContainer = document.getElementById('contentWithBreaks');
            if (!contentContainer) {
                contentContainer = document.createElement('div');
                contentContainer.id = 'contentWithBreaks';
                contentContainer.className = 'content-with-breaks';
                // ì ì ˆí•œ ìœ„ì¹˜ì— ì»¨í…Œì´ë„ˆ ì¶”ê°€
                const textareaContainer = document.querySelector('.textarea-container');
                textareaContainer.parentNode.insertBefore(contentContainer, textareaContainer.nextSibling);
            }

            contentContainer.innerHTML = `
                <h3 class="suggestion-title">ë¬¸ë‹¨ ë¶„í•  ì œì•ˆ</h3>
                ${highlightedContent}
            `;
        }



        // ëª¨ë‹¬ ì œì–´ í•¨ìˆ˜
        function showTipModal() {
            const modal = document.getElementById('tipModal');
            const overlay = document.getElementById('modalOverlay');
            if (modal && overlay) {
                modal.classList.add('active');
                overlay.classList.add('active');
            }
        }

        function closeTipModal() {
            const modal = document.getElementById('tipModal');
            const overlay = document.getElementById('modalOverlay');
            if (modal && overlay) {
                modal.classList.remove('active');
                overlay.classList.remove('active');
            }
        }

         function displayAnalysis(analysis, essayData) {
         const result = document.getElementById('result');

         // ì œëª© ë¶„ì„ ë°ì´í„° ë¨¼ì € ì¶”ì¶œ
         const titleSection = analysis.match(/# ì œëª© ë¶„ì„\n([\s\S]+?)(?=\n#|$)/)?.[1] || '';
         const titleData = {
             current: essayData.title || '',
             grade: titleSection.match(/ë“±ê¸‰:\s*([A-F][+]?)/)?.[1] || 'C',
             analysis: titleSection.match(/ë¶„ì„:([\s\S]*?)(?=\nì œì•ˆ:|$)/)?.[1]?.trim() || '',
             suggestions: titleSection.match(/ì œì•ˆ:([\s\S]*?)$/)?.[1]?.split(/\d+\.\s*/)
                 .filter(s => s.trim())
                 .map(s => s.trim()) || []
         };

         // í‰ê°€ í•­ëª© ë°ì´í„° ì¶”ì¶œ
         const categories = {
             'ë…¼ë¦¬ì„±': 'ì£¼ì¥ê³¼ ê·¼ê±°ì˜ íƒ€ë‹¹ì„±, ë…¼ë¦¬ì  íë¦„',
             'êµ¬ì¡°ì„±': 'ê¸€ì˜ êµ¬ì¡°ì™€ ë¬¸ë‹¨ ê°„ ì—°ê²°ì„±',
             'í‘œí˜„ì„±': 'ì–´íœ˜ì™€ ë¬¸ì¥ì˜ í‘œí˜„, ë§ì¶¤ë²•',
             'ì™„ì„±ë„': 'ì „ì²´ì ì¸ ê¸€ì˜ ì™„ì„±ë„ì™€ í†µì¼ì„±'
         };

         // scores ê°ì²´ ìƒì„±
        const scores = {};
        Object.keys(categories).forEach(category => {
            scores[category] = extractCategoryData(analysis, category);
        });

         // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ ì¶”ê°€
         console.log('ì œëª© ë°ì´í„°:', titleData);
         console.log('ì ìˆ˜ ë°ì´í„°:', scores);

         // ì›ë¬¸ í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
         const originalText = essayData.content;
         const hasVisibleBreaks = originalText.includes('\n');

         // ë¬¸ë‹¨ ë¶„ì„ ë°ì´í„° ì¶”ì¶œ
         const extractedParagraphs = extractParagraphs(analysis);
         const paragraphCount = hasVisibleBreaks ? extractedParagraphs.length : 1;

         // ì ìˆ˜ ê²€ì¦ ì¶”ê°€
         const validatedScores = validateScores(scores, paragraphCount);

         // ì´ì  ê³„ì‚° ì‹œ titleData ì „ë‹¬
         const score = calculateTotalScore(validatedScores, titleData);
         const totalEvaluation = analysis.match(/ì´í‰:\s*([^\n]+)/)?.[1] || '';

         // ë¬¸ë‹¨ êµ¬ë¶„ ì•Œë¦¼ì°½ í‘œì‹œ ì—¬ë¶€
         const showParagraphAlert = !hasVisibleBreaks && originalText.length > 200;

         // ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ ë°ì´í„° ì¶”ì¶œ
         const structureSection = analysis.match(/# ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ\n([\s\S]+?)(?=\n#|$)/)?.[1] || '';

         const currentStructure = structureSection.match(/í˜„ì¬ ë¬¸ë‹¨ êµ¬ì¡°:([\s\S]+?)(?=ë¬¸ë‹¨ êµ¬ì„± ê°œì„ ì•ˆ:|$)/i)?.[1]?.trim() || '';
         const improvedStructure = structureSection.match(/ë¬¸ë‹¨ êµ¬ì„± ê°œì„ ì•ˆ:([\s\S]+?)(?=êµ¬ì²´ì  ì‹¤í–‰ ë°©ì•ˆ:|$)/i)?.[1]?.trim() || '';
         const structureSuggestions = structureSection.match(/êµ¬ì²´ì  ì‹¤í–‰ ë°©ì•ˆ:([\s\S]*?)$/i)?.[1]?.trim() || '';

         const hasCurrent = Boolean(currentStructure);
         const hasImproved = Boolean(improvedStructure);
         const hasSuggestions = Boolean(structureSuggestions);

         // í†µê³„ ë°ì´í„° ì¶”ì¶œ
         const actualSentenceCount = countSentences(essayData.content);
         const actualCharCount = countCharacters(essayData.content);

         // í†µê³„ ê°ì²´ ìƒì„±
         const statistics = {
             charCount: actualCharCount,
             sentenceCount: actualSentenceCount,
             paragraphCount: paragraphCount,
             avgSentenceLength: Math.round(actualCharCount / actualSentenceCount) || 0
         };

            // ê²°ê³¼ HTML ìƒì„±
            let resultHTML = `
                <!-- ê²°ê³¼ ì „ì²´ë¥¼ ê°ì‹¸ëŠ” í° ì‚¬ê° ë°•ìŠ¤ ì‹œì‘ -->
                <div class="bg-white rounded-lg shadow-lg p-4 sm:p-8 mb-6 print-section">
                    ${showParagraphAlert ? `
                        <div class="paragraph-alert mb-6">
                            <div class="alert-title">
                                <span class="alert-icon">ğŸ’¡</span>
                                ë¬¸ë‹¨ ë‚˜ëˆ„ê¸°ê°€ í•„ìš”í•´ìš”!
                            </div>
                            <div class="alert-content">
                                <p style="text-indent: 1.5em;">ê¸´ ê¸€ì„ í•œ ë²ˆì— ì­‰ ì“°ë©´ ì½ê¸°ê°€ ì–´ë ¤ì›Œìš”. ë‹¤ìŒê³¼ ê°™ì´ ë¬¸ë‹¨ì„ ë‚˜ëˆ„ë©´ ë” ì¢‹ì€ ê¸€ì´ ë  ê±°ì˜ˆìš”:</p>
                                <ul class="mt-2">
                                    <li>âœï¸ ë¹„ìŠ·í•œ ë‚´ìš©ë¼ë¦¬ ëª¨ì•„ì„œ í•œ ë¬¸ë‹¨ìœ¼ë¡œ ë§Œë“¤ê¸°</li>
                                    <li>âœï¸ í•œ ë¬¸ë‹¨ì€ 3~5ê°œì˜ ë¬¸ì¥ìœ¼ë¡œ êµ¬ì„±í•˜ê¸°</li>
                                    <li>âœï¸ ìƒˆë¡œìš´ ë‚´ìš©ì´ ì‹œì‘ë˜ë©´ í•œ ì¤„ ë„ìš°ê¸°</li>
                                </ul>
                            </div>
                        </div>
                    ` : ''}

                    <!-- ì œëª© ë¶€ë¶„ -->
                    <div class="result-title-container">
                        <div class="result-title">ê¸€ì“°ê¸° í‰ê°€ ê²°ê³¼</div>
                        <div class="result-date">${new Date().toLocaleDateString('ko-KR')} ë¶„ì„</div>
                    </div>

                    <!-- í•™ìƒ ì •ë³´ -->
                    <div class="student-info-card bg-gray-50 p-4 rounded-lg mb-6 flex items-center gap-4">
                        <div class="student-info-item flex items-center">
                            <span class="student-info-icon text-2xl mr-2">ğŸ“</span>
                            <span class="student-info-label font-semibold text-gray-700 mr-1">í•™ë…„:</span>
                            <span class="student-info-value font-medium text-gray-800">${essayData.grade}</span>
                        </div>
                        <div class="student-info-item flex items-center">
                            <span class="student-info-icon text-2xl mr-2">ğŸ«</span>
                            <span class="student-info-label font-semibold text-gray-700 mr-1">ë°˜:</span>
                            <span class="student-info-value font-medium text-gray-800">${essayData.class}</span>
                        </div>
                        <div class="student-info-item flex items-center">
                            <span class="student-info-icon text-2xl mr-2">ğŸ”¢</span>
                            <span class="student-info-label font-semibold text-gray-700 mr-1">ë²ˆí˜¸:</span>
                            <span class="student-info-value font-medium text-gray-800">${essayData.number}</span>
                        </div>
                        <div class="student-info-item flex items-center">
                            <span class="student-info-icon text-2xl mr-2">ğŸ“</span>
                            <span class="student-info-label font-semibold text-gray-700 mr-1">ì´ë¦„:</span>
                            <span class="student-info-value font-medium text-gray-800">${essayData.name}</span>
                        </div>
                    </div>


                    <!-- í‰ê°€ ê°œìš” ì„¹ì…˜ -->
                    <div class="flex flex-col gap-8 p-6">
                        <!-- ì ìˆ˜ì™€ ì´í‰ ì„¹ì…˜ -->
                        <div class="flex items-center gap-6">
                            <div class="flex items-center">
                                <div class="bg-blue-100 rounded-full w-24 h-24 flex items-center justify-center">
                                    <span class="text-blue-600 text-4xl font-bold">${score}ì </span>
                                </div>
                            </div>
                            <div class="h-20 w-px bg-gray-200 mx-4"></div>
                            <p class="text-gray-700 text-lg flex-1">${totalEvaluation}</p>
                        </div>

                        <!-- ë ˆì´ë” ì°¨íŠ¸ì™€ ì˜¤ë¥¸ìª½ ì»¨í…ì¸  -->
                        <div class="flex gap-12">
                            <!-- ë ˆì´ë” ì°¨íŠ¸ -->
                            <div class="w-[400px] flex-shrink-0">
                                ${createRadarChart(Object.entries(scores).map(([name, data]) => ({
                                    name,
                                    grade: data.grade
                                })))}
                            </div>

                            <!-- ì˜¤ë¥¸ìª½ ì»¨í…ì¸  ì»¨í…Œì´ë„ˆ -->
                            <div class="flex flex-col flex-1 gap-6">
                                <!-- í‰ê°€ í•­ëª© ê·¸ë¦¬ë“œ -->
                                <div class="grid grid-cols-2 gap-4">
                                    ${Object.entries(categories).map(([category, description]) => {
                                        const data = scores[category];
                                        return `
                                            <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between gap-4">
                                                <div>
                                                    <div class="text-lg font-medium text-gray-900">${category}</div>
                                                    <div class="text-sm text-gray-500">${description}</div>
                                                </div>
                                                <div class="grade-badge ${getGradeStyle(data.grade)}">
                                                    ${data.grade}
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>

                                <!-- í†µê³„ ì •ë³´ -->
                                <div class="grid grid-cols-4 gap-3">
                                    <div class="bg-gray-50 p-6 rounded-lg text-center h-28 flex flex-col justify-center">
                                        <div class="text-base text-gray-500">ì´ ê¸€ì ìˆ˜</div>
                                        <div class="text-2xl font-bold text-blue-600">${statistics.charCount}ì</div>
                                    </div>
                                    <div class="bg-gray-50 p-6 rounded-lg text-center h-28 flex flex-col justify-center">
                                        <div class="text-base text-gray-500">ì´ ë¬¸ì¥ ìˆ˜</div>
                                        <div class="text-2xl font-bold text-blue-600">${statistics.sentenceCount}ê°œ</div>
                                    </div>
                                    <div class="bg-gray-50 p-6 rounded-lg text-center h-28 flex flex-col justify-center">
                                        <div class="text-base text-gray-500">ì´ ë¬¸ë‹¨ ìˆ˜</div>
                                        <div class="text-2xl font-bold text-blue-600">${statistics.paragraphCount}ê°œ</div>
                                    </div>
                                    <div class="bg-gray-50 p-6 rounded-lg text-center h-28 flex flex-col justify-center">
                                        <div class="text-base text-gray-500">í‰ê·  ë¬¸ì¥ ê¸¸ì´</div>
                                        <div class="text-2xl font-bold text-blue-600">${statistics.avgSentenceLength}ì</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ì˜ì—­ë³„ ë¶„ì„ -->
                    <h2 class="section-title">ì˜ì—­ë³„ ë¶„ì„</h2>
                    <div class="category-grid">
                        ${Object.entries(scores).map(([category, data]) => `
                            <div class="analysis-category-section">
                                <div class="category-header">
                                    <div class="category-title-wrap">
                                        <div class="category-name">${category}</div>
                                        <div class="category-subtitle">${categories[category]}</div>
                                    </div>
                                    <div class="category-grade ${getGradeStyle(data.grade)}">
                                        ${data.grade}
                                    </div>
                                </div>
                                <div class="feedback-grid">
                                    <div class="feedback-box analysis">
                                        <div class="feedback-title analysis">í‰ê°€</div>
                                        <div class="feedback-content">${data.evaluation}</div>
                                    </div>
                                    <div class="feedback-box good-points">
                                        <div class="feedback-title good-points">ì˜ëœ ì </div>
                                        <div class="feedback-content">${data.goodPoints}</div>
                                    </div>
                                    <div class="feedback-box improvements">
                                        <div class="feedback-title improvements">ê°œì„ ì </div>
                                        <div class="feedback-content">${data.improvements}</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- ì œëª© ë¶„ì„ ì„¹ì…˜ -->
                    <div class="title-analysis">
                        <div class="section-header flex justify-between items-center">
                            <div style="display: flex; align-items: center; gap: 2rem;">
                                <h2 class="section-title">ì œëª© ë¶„ì„</h2>
                                <div class="category-grade ${getGradeStyle(titleData?.grade || 'C')}">
                                    ${titleData?.grade || 'C'}
                                </div>
                            </div>
                        </div>
                        <div class="title-analysis-content">
                            <div class="title-analysis-item">
                                <div class="title-analysis-label">í˜„ì¬ ì œëª©</div>
                                <div class="text-gray-700">${titleData.current}</div>
                            </div>
                            <div class="title-analysis-item">
                                <div class="title-analysis-label">ë¶„ì„</div>
                                <div class="text-gray-700 whitespace-pre-line">${titleData.analysis}</div>
                            </div>
                            <div class="title-analysis-item">
                                <div class="title-analysis-label">ì œì•ˆ</div>
                                <div class="text-gray-700">${titleData.suggestions.join('\n')}</div>
                            </div>
                        </div>
                    </div>

                    <!-- ë¬¸ë‹¨ë³„ ìƒì„¸ ë¶„ì„ -->
                    <h2 class="section-title">ë¬¸ë‹¨ë³„ ìƒì„¸ ë¶„ì„</h2>
                    <div class="paragraphs-container">
                        ${extractedParagraphs.map(paragraph => `
                        <div class="paragraph-section mt-8">
                                <div class="paragraph-header">
                                    <h4 class="paragraph-title">${paragraph.index}ë²ˆì§¸ ë¬¸ë‹¨</h4>
                                    <button class="tip-button" type="button" onclick="showTipModal()">ë¬¸ë‹¨ êµ¬ë¶„ íŒ</button>
                                </div>
                                <div class="original-text">${paragraph.content}</div>
                                <div class="paragraph-analysis-section">
                                    <div class="analysis-box analysis">
                                        <div class="analysis-box-header">ë¶„ì„</div>
                                        <div class="analysis-box-content">${paragraph.analysis}</div>
                                    </div>
                                    <div class="analysis-box good-points">
                                        <div class="analysis-box-header">ì˜ëœ ì </div>
                                        <div class="analysis-box-content">${paragraph.goodPoints}</div>
                                    </div>
                                    <div class="analysis-box improvements">
                                        <div class="analysis-box-header">ê°œì„ ì </div>
                                        <div class="analysis-box-content">${paragraph.improvements}</div>
                                    </div>
                                </div>
                                ${paragraph.suggestions.length > 0 ? `
                                   <div class="suggestion-box">
                                       <div class="suggestion-title">í‘œí˜„ ê°œì„  ì œì•ˆ</div>
                                       <ul class="suggestion-list">
                                           ${paragraph.suggestions.map(function(suggestion) {
                                               return `<li class="suggestion-item">${suggestion}</li>`;
                                           }).join('')}
                                       </ul>
                                   </div>
                                   <div class="suggestion-box spelling">
                                       <div class="suggestion-title">ë§ì¶¤ë²• êµì •</div>
                                       <ul class="suggestion-list">
                                           ${paragraph.spellingCorrections?.map(function(correction) {
                                               return `<li class="suggestion-item">
                                                   <span class="correction-original">${correction.original}</span> â†’
                                                   <span class="correction-fixed">${correction.fixed}</span>
                                                   <div class="correction-reason">${correction.reason}</div>
                                               </li>`;
                                           }).join('') || 'ë§ì¶¤ë²• êµì •ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'}
                                       </ul>
                                   </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>

                    <!-- ëª¨ë‹¬ ì°½ ì¶”ê°€ -->
                    <div class="tip-modal hidden" id="tipModal">
                        <h3 class="text-xl font-bold mb-4">ë¬¸ë‹¨ ë‚˜ëˆ„ê¸° Tips!</h3>
                        <ul class="space-y-2">
                            <li>âœï¸ í•˜ë‚˜ì˜ ë¬¸ë‹¨ì—ëŠ” í•˜ë‚˜ì˜ ì¤‘ì‹¬ ìƒê°ë§Œ ë‹´ì•„ìš”.</li>
                            <li>âœï¸ ìƒˆë¡œìš´ ë‚´ìš©ì´ ì‹œì‘ë˜ë©´ ìƒˆë¡œìš´ ë¬¸ë‹¨ìœ¼ë¡œ ë‚˜ëˆ ìš”.</li>
                            <li>âœï¸ ë¬¸ë‹¨ì˜ ì²« ë¬¸ì¥ì— ì¤‘ì‹¬ ë‚´ìš©ì„ ë‹´ì•„ìš”.</li>
                            <li>âœï¸ ë³´í†µ 3~5ë¬¸ì¥ì´ í•œ ë¬¸ë‹¨ì´ ë˜ì–´ìš”.</li>
                            <li>âœï¸ ë“¤ì—¬ì“°ê¸°ë¡œ ë¬¸ë‹¨ì˜ ì‹œì‘ì„ í‘œì‹œí•´ìš”.</li>
                        </ul>
                        <button class="mt-4 bg-blue-500 text-white px-4 py-2 rounded" onclick="closeTipModal()">
                            ì•Œê² ì–´ìš”!
                        </button>
                    </div>
                    <div class="modal-overlay hidden" id="modalOverlay" onclick="closeTipModal()"></div>

                    <!-- ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ -->
                    <h2 class="section-title">ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ</h2>
                    <div class="structure-container">
                        <div class="structure-section">
                            <h3 class="structure-section-title">í˜„ì¬ ë¬¸ë‹¨ êµ¬ì¡°</h3>
                            ${formatStructureContent(currentStructure, 'current')}
                        </div>
                        <div class="structure-section">
                            <h3 class="structure-section-title">ë¬¸ë‹¨ êµ¬ì„± ê°œì„ ì•ˆ</h3>
                            ${formatStructureContent(improvedStructure, 'improved')}
                        </div>
                        <div class="structure-section">
                            <h3 class="structure-section-title">êµ¬ì²´ì  ì‹¤í–‰ ë°©ì•ˆ</h3>
                            ${formatStructureContent(structureSuggestions, 'suggestions')}
                        </div>
                    </div>
                <!-- ê²°ê³¼ ì „ì²´ë¥¼ ê°ì‹¸ëŠ” í° ì‚¬ê° ë°•ìŠ¤ ë -->

                <!-- í”„ë¦°íŠ¸ ë²„íŠ¼ -->
                <div class="print-button-container no-print">
                    <button onclick="window.print()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        í”„ë¦°íŠ¸í•˜ê¸°
                    </button>
                </div>
            `;

             // ê²°ê³¼ í‘œì‹œ
                 result.innerHTML = resultHTML;
                 result.classList.remove('hidden');
             }


        // ë„ì›€ í•¨ìˆ˜ë“¤
        function getCategoryDescription(category) {
            const descriptions = {
                'ë…¼ë¦¬ì„±': 'ì£¼ì¥ê³¼ ê·¼ê±°ì˜ íƒ€ë‹¹ì„±, ë…¼ë¦¬ì  íë¦„',
                'êµ¬ì¡°ì„±': 'ê¸€ì˜ êµ¬ì¡°ì™€ ë¬¸ë‹¨ ê°„ ì—°ê²°ì„±',
                'í‘œí˜„ì„±': 'ì–´íœ˜ì™€ ë¬¸ì¥ì˜ í‘œí˜„, ë§ì¶¤ë²•',
                'ì™„ì„±ë„': 'ì „ì²´ì ì¸ ê¸€ì˜ ì™„ì„±ë„ì™€ í†µì¼ì„±'
            };
            return descriptions[category] || '';
        }

        function getGradeStyle(grade) {
            const styles = {
                'A+': 'bg-blue-100 text-blue-800 border-2 border-blue-300',
                'A': 'bg-blue-100 text-blue-800 border-2 border-blue-300',
                'B+': 'bg-green-100 text-green-800 border-2 border-green-300',
                'B': 'bg-green-100 text-green-800 border-2 border-green-300',
                'C+': 'bg-yellow-100 text-yellow-800 border-2 border-yellow-300',
                'C': 'bg-yellow-100 text-yellow-800 border-2 border-yellow-300',
                'D+': 'bg-orange-100 text-orange-800 border-2 border-orange-300',
                'D': 'bg-orange-100 text-orange-800 border-2 border-orange-300',
                'F': 'bg-red-100 text-red-800 border-2 border-red-300'
            };
            return styles[grade] || 'bg-gray-100 text-gray-800 border-2 border-gray-300';
        }

        // ë¬¸ë‹¨ ë¶„ì„ ë³´ì¡° í•¨ìˆ˜
         function extractParagraphs(analysis) {
             const paragraphs = [];
             const paragraphRegex = /\[(\d+)ë¬¸ë‹¨\]([\s\S]+?)(?=\[\d+ë¬¸ë‹¨\]|#|$)/g;
             const matches = Array.from(analysis.matchAll(paragraphRegex));

             for (const match of matches) {
                 try {
                     const paragraphNum = match[1];
                     const content = match[2];

                     // ê° ì„¹ì…˜ ì¶”ì¶œ
                     const originalMatch = content.match(/ì›ë¬¸:\s*([\s\S]*?)(?=\s*ë¶„ì„:)/);
                     const analysisMatch = content.match(/ë¶„ì„:\s*([\s\S]*?)(?=\s*ì˜ëœ ì :)/);
                     const goodPointsMatch = content.match(/ì˜ëœ ì :\s*([\s\S]*?)(?=\s*ê°œì„ ì :)/);
                     const improvementsMatch = content.match(/ê°œì„ ì :\s*([\s\S]*?)(?=\s*í‘œí˜„ ê°œì„  ì œì•ˆ:|ë§ì¶¤ë²• êµì •:|$)/);
                     const suggestionsMatch = content.match(/í‘œí˜„ ê°œì„  ì œì•ˆ:\s*([\s\S]*?)(?=ë§ì¶¤ë²• êµì •:|$)/);
                     const spellingMatch = content.match(/ë§ì¶¤ë²• êµì •:\s*([\s\S]*?)$/);

                     // ì›ë¬¸ ì²˜ë¦¬
                     let originalContent = '';
                     if (originalMatch) {
                         originalContent = originalMatch[1]
                             .replace(/^[\s"]+|[\s"]+$/g, '')
                             .split('\n')
                             .map(line => line.trim())
                             .filter(Boolean)
                             .join('\n');
                     }

                     // í‘œí˜„ ê°œì„  ì œì•ˆ ì²˜ë¦¬
                     const suggestions = suggestionsMatch
                         ? suggestionsMatch[1]
                             .split(/\n/)
                             .map(line => line.trim())
                             .filter(line => line.length > 0 && !line.match(/^[\s*â€¢-]*$/))
                             .map(line => line.replace(/^[*â€¢-]\s*/, ''))
                         : [];

                     // ë§ì¶¤ë²• êµì • ì²˜ë¦¬
                     const spellingCorrections = spellingMatch
                         ? spellingMatch[1]
                             .split(/\n/)
                             .map(line => line.trim())
                             .filter(line => line.length > 0)
                             .map(line => {
                                 const [original, fixed, ...rest] = line.split(/\s*->\s*|\s*,\s*/);
                                 return {
                                     original: original?.replace(/^["']|["']$/g, ''),
                                     fixed: fixed?.replace(/^["']|["']$/g, ''),
                                     reason: rest.join(', ').trim()
                                 };
                             })
                             .filter(correction => correction.original && correction.fixed)
                         : [];

                     paragraphs.push({
                         index: paragraphNum,
                         content: originalContent,
                         analysis: analysisMatch?.[1]?.trim() || '',
                         goodPoints: goodPointsMatch?.[1]?.trim() || '',
                         improvements: improvementsMatch?.[1]?.trim() || '',
                         suggestions: suggestions,
                         spellingCorrections: spellingCorrections
                     });
                 } catch (error) {
                     console.error(`ë¬¸ë‹¨ ${match[1]} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:`, error);
                 }
             }

             return paragraphs.sort((a, b) => parseInt(a.index) - parseInt(b.index));
         }

        // ì •í™•í•œ ë¬¸ì¥ ìˆ˜ ì„¸ê¸° í•¨ìˆ˜
        function countSentences(text) {
            if (!text) return 0;

            // 1. ì¤„ë°”ê¿ˆì„ ê³µë°±ìœ¼ë¡œ ë³€ê²½
            let normalized = text.replace(/\n/g, ' ');

            // 2. ë§ˆì¹¨í‘œë‚˜ ëŠë‚Œí‘œ, ë¬¼ìŒí‘œ ë’¤ì— ê³µë°±ì´ë‚˜ ë”°ì˜´í‘œê°€ ì˜¤ëŠ” ê²½ìš°ë¥¼ ë¬¸ì¥ì˜ ëìœ¼ë¡œ ê°„ì£¼
            // ë˜í•œ ì¤„ì„í‘œ(...)ëŠ” ë¬¸ì¥ì˜ ëìœ¼ë¡œ ê°„ì£¼í•˜ì§€ ì•ŠìŒ
            const matches = normalized.match(/[^.!?]+[.!?](?:[\s"']|$)/g) || [];

            // 3. ë¹ˆ ë¬¸ì¥ì´ë‚˜ ê³µë°±ë§Œ ìˆëŠ” ë¬¸ì¥ ì œì™¸
            const validSentences = matches.filter(sentence => 
                sentence.trim().replace(/[.!?]/g, '').trim().length > 0
            );

            // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸
            console.log("Found sentences:", validSentences);

            return validSentences.length;
        }

        function renderSuggestion(container, suggestion) {
            const suggestionDiv = document.createElement('div');
            suggestionDiv.className = 'suggestion-item bg-white p-4 border-l-4 border-blue-500 my-2';

            suggestionDiv.innerHTML = `
                <p class="text-gray-900 font-medium">${suggestion.breakPoint}</p>
                <p class="text-blue-600 mt-2">ğŸ’­ ${suggestion.reason}</p>
                <p class="text-green-600 mt-2">âœï¸ ${suggestion.tip}</p>
                <div class="mt-3">
                    <button onclick="applyParagraphBreak(this)" 
                            class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 text-sm">
                        ì´ ë¶€ë¶„ì—ì„œ ë‚˜ëˆ„ê¸°
                    </button>
                </div>
            `;

            container.appendChild(suggestionDiv);
        }

        function applyParagraphBreak(position) {
            const textarea = document.getElementById('content');
            const text = textarea.value;
            position = parseInt(position); // ë¬¸ìì—´ë¡œ ì „ë‹¬ëœ positionì„ ìˆ«ìë¡œ ë³€í™˜

            try {
                // í˜„ì¬ ì»¤ì„œ ìœ„ì¹˜ ì €ì¥
                const scrollPos = textarea.scrollTop;

                // ë¬¸ë‹¨ ë‚˜ëˆ„ê¸° ì ìš©
                const newContent = 
                    text.substring(0, position) + 
                    '\n\n' + 
                    text.substring(position);

                // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                textarea.value = newContent;

                // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µì›
                textarea.scrollTop = scrollPos;

                // ë¬¸ë‹¨ ìˆ˜ ì—…ë°ì´íŠ¸
                updateParagraphCount();

                // ì„±ê³µ í”¼ë“œë°± í‘œì‹œ
                showFeedback();

                // ë¬¸ë‹¨ ë¶„ì„ ë‹¤ì‹œ ì‹¤í–‰
                analyzeParagraphs();

            } catch (error) {
                console.error('ë¬¸ë‹¨ ë‚˜ëˆ„ê¸° ì ìš© ì¤‘ ì˜¤ë¥˜:', error);
                alert('ë¬¸ë‹¨ ë‚˜ëˆ„ê¸°ë¥¼ ì ìš©í•˜ëŠ” ì¤‘ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í”¼ë“œë°± ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showFeedback() {
            const container = document.querySelector('.paragraph-suggestions-container');
            if (!container) return;

            const feedback = document.createElement('div');
            feedback.className = 'feedback-message fixed bottom-4 right-4 bg-green-100 text-green-800 p-4 rounded-lg shadow-lg';
            feedback.innerHTML = `
                <div class="flex items-center gap-2">
                    <span>âœ¨ ë¬¸ë‹¨ì„ ë‚˜ëˆ„ì—ˆì–´ìš”!</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-green-600 hover:text-green-800">âœ•</button>
                </div>
                <p class="text-sm mt-1">ë” ë‚˜ì€ ê¸€ì´ ë˜ì–´ê°€ê³  ìˆì–´ìš”.</p>
            `;

            document.body.appendChild(feedback);

            // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ì œê±°
            setTimeout(() => {
                if (feedback.parentElement) {
                    feedback.remove();
                }
            }, 3000);
        }

        // ë¬¸ë‹¨ ìˆ˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateParagraphCount() {
            const content = document.getElementById('content').value;
            const paragraphCount = document.querySelector('.paragraph-count');
            const count = content.split('\n').filter(p => p.trim().length > 0).length;
            paragraphCount.textContent = `ë¬¸ë‹¨ìˆ˜: ${count}ê°œ`;
        }
        // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeModal() {
            const modal = document.querySelector('.tip-modal');
            const overlay = document.querySelector('.modal-overlay');
            if (modal) modal.remove();
            if (overlay) overlay.remove();
        }

        document.addEventListener('DOMContentLoaded', function() {
            const content = document.getElementById('content');
            const charCount = document.querySelector('.char-count');
            const paragraphCount = document.querySelector('.paragraph-count');
            const paragraphAnalysis = document.querySelector('.paragraph-analysis');

            if (!content) return; // content ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ

            // í…ìŠ¤íŠ¸ ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            content.addEventListener('input', function() {
                // ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
                const totalCount = countCharacters(this.value);
                charCount.textContent = `ê¸€ììˆ˜: ${totalCount}ì`;

                // ë¬¸ë‹¨ ìˆ˜ ì—…ë°ì´íŠ¸
                const paragraphs = this.value.split(/\n\s*\n/).filter(p => p.trim().length > 0);
                const paragraphNum = paragraphs.length;
                paragraphCount.textContent = `ë¬¸ë‹¨ìˆ˜: ${paragraphNum}ê°œ`;

                // ë¬¸ë‹¨ ë¶„ì„ ì—…ë°ì´íŠ¸
                updateParagraphAnalysis(paragraphs);
            });

            // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            triggerInitialAnalysis();
        });

        // ë¬¸ë‹¨ ë¶„ì„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateParagraphAnalysis(paragraphs) {
            const paragraphAnalysis = document.querySelector('.paragraph-analysis');
            if (!paragraphAnalysis) return;

            const count = paragraphs.length;
            let message = '';

            switch(count) {
                case 0:
                    message = 'ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”';
                    break;
                case 1:
                    message = 'ì²« ë¬¸ë‹¨ì„ ì‘ì„±í–ˆë„¤ìš”. ìƒˆë¡œìš´ ë‚´ìš©ì´ ì‹œì‘ë˜ë©´ ì—”í„°í‚¤ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
                    break;
                case 2:
                    message = 'ì¢‹ì•„ìš”! ë‘ ê°œì˜ ë¬¸ë‹¨ìœ¼ë¡œ ë‚´ìš©ì„ ë‚˜ëˆ„ì—ˆì–´ìš”. ë” ë‚˜ëˆŒìˆ˜ë„ ìˆë‚˜ìš”?';
                    break;
                case 3:
                    message = 'ë¬¸ë‹¨ì„ ì ì ˆíˆ ë‚˜ëˆ„ê³  ìˆì–´ìš”. ê° ë¬¸ë‹¨ì˜ ë‚´ìš©ì´ ì„œë¡œ ë‹¬ë¼ì•¼ í•´ìš”.';
                    break;
                case 4:
                case 5:
                    message = 'ë¬¸ë‹¨ êµ¬ë¶„ì´ ì˜ ë˜ì–´ìˆì–´ìš”. ê° ë¬¸ë‹¨ì´ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ë‚˜ìš”?';
                    break;
                default:
                    message = 'ë¬¸ë‹¨ì´ ë„ˆë¬´ ë§ì•„ìš”. ë¹„ìŠ·í•œ ë‚´ìš©ì€ í•œ ë¬¸ë‹¨ìœ¼ë¡œ ëª¨ì•„ë³´ì„¸ìš”.';
            }

            paragraphAnalysis.innerHTML = `<span>${message}</span>`;
        }

        // ì´ˆê¸° ë¶„ì„ ì‹¤í–‰ í•¨ìˆ˜
        function triggerInitialAnalysis() {
            const content = document.getElementById('content');
            if (content && content.value) {
                const event = new Event('input');
                content.dispatchEvent(event);
            }
        }

        // ê¸€ì ìˆ˜ ì„¸ê¸° í•¨ìˆ˜ ê°œì„ 
        function countCharacters(text) {
            if (!text) return 0;
            // ì¤„ë°”ê¿ˆì€ ì¹´ìš´íŠ¸ì—ì„œ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ ê³µë°±ì€ í¬í•¨
            return text.replace(/\n/g, '').length;
        }

         // ë¬¸ë‹¨ ë‚˜ëˆ„ê¸° ì œì•ˆ í•¨ìˆ˜
         function analyzeParagraph(text) {
             // ë¬¸ë‹¨ì„ ë‚˜ëˆ„ëŠ” ê¸°ì¤€ìœ¼ë¡œ ì¤„ë°”ê¿ˆ(\n) ë§Œì„ í™œìš©í•˜ë„ë¡ í•œë‹¤.
             let paragraphs = text.split('\n').filter(paragraph => paragraph.trim().length > 0);

             // ë¬¸ë‹¨ ìˆ˜ê°€ 1ê°œì¼ ê²½ìš° "1ë¬¸ë‹¨"ìœ¼ë¡œ í‰ê°€ë˜ë„ë¡ ìˆ˜ì •
             if (paragraphs.length === 1) {
                 return [{
                     type: 'single',
                     content: "ë¬¸ë‹¨ì´ ë‚˜ëˆ„ì–´ì§€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. 1ê°œì˜ ë¬¸ë‹¨ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤."
                 }];
             }

             // ë¬¸ë‹¨ ìˆ˜ê°€ ì—¬ëŸ¬ ê°œì¼ ê²½ìš° ê¸°ì¡´ ë¶„ì„ ë¡œì§ ìˆ˜í–‰
             let suggestions = [];

             paragraphs.forEach((paragraph, index) => {
                 // ë¬¸ì¥ ìˆ˜ ì²´í¬ (3ë¬¸ì¥ ì´ìƒì¸ ê²½ìš°)
                 let sentences = paragraph.match(/[^.!?]+[.!?]+/g) || [];
                 if (sentences.length >= 3) {
                     suggestions.push({
                         type: 'length',
                         index: index + 1,
                         content: paragraph.substring(0, 50) + "...",
                         reason: "ì´ ë¬¸ë‹¨ì— ë¬¸ì¥ì´ 3ê°œ ì´ìƒ ìˆì–´ìš”. ìƒˆë¡œìš´ ë‚´ìš©ì´ ì‹œì‘ë˜ë©´ ì—”í„°í‚¤ë¥¼ ëˆŒëŸ¬ì„œ ë‚˜ëˆ„ë©´ ì¢‹ê² ì–´ìš”.",
                         position: paragraph.length
                     });
                 }

                 // ì ‘ì†ì‚¬ë¡œ ì‹œì‘í•˜ëŠ” ë¬¸ì¥ ì²´í¬
                 let conjunctions = ['í•˜ì§€ë§Œ', 'ê·¸ëŸ¬ë‚˜', 'ê·¸ë˜ì„œ', 'ë”°ë¼ì„œ', 'ê·¸ë¦¬ê³ ', 'ë˜í•œ'];
                 if (conjunctions.some(conj => paragraph.trim().startsWith(conj))) {
                     suggestions.push({
                         type: 'conjunction',
                         index: index + 1,
                         content: paragraph.substring(0, 50) + "...",
                         reason: `'${paragraph.split(' ')[0]}'(ìœ¼)ë¡œ ì‹œì‘í•˜ëŠ” ìƒˆë¡œìš´ ë‚´ìš©ì´ì—ìš”. ìœ—ì¤„ì—ì„œ ì—”í„°í‚¤ë¥¼ ëˆŒëŸ¬ ë¬¸ë‹¨ì„ ë‚˜ëˆ„ë©´ ì¢‹ì•„ìš”.`,
                         position: 0
                     });
                 }
             });

             return suggestions;
         }

         // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
         let inputText = `ì¹œêµ¬ë‘ ì¹œí•˜ê²Œ ì§€ë‚´ì•¼ í•˜ëŠ” ì´ìœ ëŠ” ì •ë§ ë§ìŠµë‹ˆë‹¤. ì¹œêµ¬ë‘ ë†€ë©´ í˜¼ì ìˆëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ ì¬ë¯¸ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì¹œêµ¬ë‘ ì¶•êµ¬ë¥¼ í•˜ë©´ ê³¨ì„ ë„£ì—ˆì„ ë•Œ ë” ì‹ ë‚˜ê³ , í˜¼ìì„œ ì¶•êµ¬ë¥¼ í•˜ëŠ” ê±´ ì¢€ ì‹¬ì‹¬í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì¹œêµ¬ê°€ ìˆìœ¼ë©´ ë‚´ê°€ ìŠ¬í”„ê±°ë‚˜ ì†ìƒí•  ë•Œ ìœ„ë¡œí•´ ì¤„ ìˆ˜ ìˆì–´ì„œ ì¢‹ìŠµë‹ˆë‹¤. ì¹œêµ¬ë‘ ì–˜ê¸°í•˜ë‹¤ ë³´ë©´ ë‚´ê°€ ëª°ëë˜ ê±¸ ì•Œê²Œ ë  ë•Œë„ ë§ìŠµë‹ˆë‹¤. ë˜ ì¹œêµ¬ê°€ ì›ƒê¸´ ì´ì•¼ê¸°ë¥¼ í•´ ì¤„ ë•Œ ì •ë§ ë§ì´ ì›ƒì–´ì„œ ê¸°ë¶„ì´ ì¢‹ì•„ì§‘ë‹ˆë‹¤. í•™êµì—ì„œë„ ì¹œêµ¬ê°€ ìˆìœ¼ë©´ ì‰¬ëŠ” ì‹œê°„ì— ë†€ ìˆ˜ ìˆì–´ì„œ ì‹¬ì‹¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì €ëŠ” ì¹œêµ¬ë‘ ì¹œí•˜ê²Œ ì§€ë‚´ëŠ” ê²Œ ê¼­ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆê¹Œ ì¹œêµ¬ê°€ ë§ìœ¼ë©´ ì¢‹ìŠµë‹ˆë‹¤.`;

         console.log(analyzeParagraph(inputText));


        // ìƒˆë¡œ ì¶”ê°€ë˜ëŠ” ì½”ë“œ
        function toggleParagraphPreview() {
            const content = document.getElementById('content').value;
            const previewContent = document.getElementById('previewContent');

            if (!content.trim()) {
                alert('ë¯¸ë¦¬ë³´ê¸°í•  ë‚´ìš©ì„ ë¨¼ì € ì‘ì„±í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (previewContent.classList.contains('hidden')) {
                const paragraphs = content.split('\n').filter(p => p.trim());
                let previewHTML = '<div class="preview-paragraphs">';

                paragraphs.forEach((paragraph, index) => {
                    previewHTML += `
                        <div class="preview-paragraph">
                            <div class="preview-paragraph-header">
                                ${index + 1}ë²ˆì§¸ ë¬¸ë‹¨
                            </div>
                            <div class="preview-paragraph-content">
                                ${paragraph}
                            </div>
                        </div>
                    `;
                });
                previewHTML += '</div>';

                previewContent.innerHTML = previewHTML;
                previewContent.classList.remove('hidden');
                document.querySelector('.preview-button').innerHTML = 
                    '<span>ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸°</span><span class="button-icon">âœ•</span>';
            } else {
                previewContent.classList.add('hidden');
                document.querySelector('.preview-button').innerHTML = 
                    '<span>ë¬¸ë‹¨ ë¯¸ë¦¬ë³´ê¸°</span><span class="button-icon">ğŸ‘ï¸</span>';
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìˆ˜ì •
        document.addEventListener('DOMContentLoaded', function() {
            const content = document.getElementById('content');
            if (content) {
                content.addEventListener('input', function() {
                    updateParagraphCount();
                    const charCount = document.querySelector('.char-count');
                    charCount.textContent = `ê¸€ììˆ˜: ${countCharacters(this.value)}ì`;

                    // ë¬¸ë‹¨ ë¶„ì„ ì—…ë°ì´íŠ¸
                    const paragraphs = this.value.split('\n').filter(p => p.trim());
                    updateParagraphAnalysis(paragraphs);
                });
            }
        });

        // í‰ê°€ í•­ëª© ë°ì´í„° ì¶”ì¶œ í•¨ìˆ˜
         function extractCategoryData(analysis, category) {
             try {
                 const categoryRegex = new RegExp(`\\[${category}\\]([^]*?)(?=\\[|#|$)`);
                 const categoryText = analysis.match(categoryRegex)?.[1] || '';

                 console.log('Category Text:', categoryText);

                 const gradeMatch = categoryText.match(/ë“±ê¸‰:\s*([A-F][+]?)/);
                 const evaluationMatch = categoryText.match(/í‰ê°€:([^]*?)(?=ì˜ëœ ì :|$)/);
                 const goodPointsMatch = categoryText.match(/ì˜ëœ ì :\s*([\s\S]*?)(?=ê°œì„ ì :|$)/);
                 const improvementsMatch = categoryText.match(/ê°œì„ ì :\s*([\s\S]*?)(?=(?:\[|\n#|$))/);

                 const result = {
                     grade: gradeMatch ? gradeMatch[1] : 'F',
                     evaluation: evaluationMatch ? evaluationMatch[1].trim() : '',
                     goodPoints: goodPointsMatch ? goodPointsMatch[1].trim() : '',
                     improvements: improvementsMatch ? improvementsMatch[1].trim() : ''
                 };

                 console.log('Extracted Data:', result);
                 return result;

             } catch (error) {
                 console.error(`Error extracting data for ${category}:`, error);
                 return {
                     grade: 'F',
                     evaluation: '',
                     goodPoints: '',
                     improvements: ''
                 };
             }
         }

         function formatStructureContent(content, type = 'default') {
             if (!content || content === 'undefined') {
                 return `
                     <div class="content-section">
                         <p class="text-gray-500">ì•„ì§ ë¶„ì„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                     </div>
                 `;
             }

             try {
                 switch (type) {
                     case 'current':
                         // í˜„ì¬ ë¬¸ë‹¨ êµ¬ì¡°ë¥¼ í•˜ë‚˜ì˜ ë°•ìŠ¤ë¡œ í‘œì‹œ
                         return `
                             <div class="content-section">
                                 ${content.split('\n')
                                     .filter(line => line.trim())
                                     .map(line => `<p class="content-line">${line}</p>`)
                                     .join('')}
                             </div>
                         `;

                     case 'improved':
                         // ê°œì„ ëœ ë¬¸ë‹¨ êµ¬ì¡° í‘œì‹œ
                         return `
                             <div class="content-section">
                                 ${content.split('\n')
                                     .filter(line => line.trim())
                                     .map(line => `<p class="content-line">${line}</p>`)
                                     .join('')}
                             </div>
                         `;

                     case 'suggestions':
                         // êµ¬ì²´ì  ì‹¤í–‰ ë°©ì•ˆ í‘œì‹œ
                         return `
                             <div class="content-section">
                                 ${content.split('\n')
                                     .filter(line => line.trim())
                                     .map(line => line.replace(/^[*â€¢-]\s*/, ''))
                                     .map(line => `<p class="content-line">â€¢ ${line}</p>`)
                                     .join('')}
                             </div>
                         `;

                     default:
                         return `
                             <div class="content-section">
                                 <p class="content-line">${content}</p>
                             </div>
                         `;
                 }
             } catch (error) {
                 console.error('ë¬¸ë‹¨ êµ¬ì¡°í™” ì˜¤ë¥˜:', error);
                 return '<div class="text-red-500">ë¬¸ë‹¨ êµ¬ì¡°ë¥¼ í‘œì‹œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
             }
         }

        document.addEventListener('DOMContentLoaded', function() {
            const content = document.getElementById('content');
            const charCount = document.querySelector('.char-count');
            const submitBtn = document.getElementById('submitBtn');

            document.addEventListener('DOMContentLoaded', function() {
                const content = document.getElementById('content');
                const charCount = document.querySelector('.char-count');
                const submitBtn = document.getElementById('submitBtn');

                // input ì´ë²¤íŠ¸ì—ì„œëŠ” ê¸€ì ìˆ˜ë§Œ ì¹´ìš´íŠ¸
                content.addEventListener('input', function() {
                    const totalCount = countCharacters(this.value);
                    charCount.textContent = `ê¸€ììˆ˜: ${totalCount}ì`;
                });

                submitBtn.addEventListener('click', async function() {
                    // submitBtn í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬...
                });
            });

        submitBtn.addEventListener('click', async function() {
    const title = document.getElementById('title').value.trim();
    const content = document.getElementById('content').value.trim();

    if (!title || !content) {
        alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }

    submitBtn.disabled = true;
    submitBtn.textContent = 'ë¶„ì„ì¤‘...';

    const essayData = {
        title: title,
        content: content,
        grade: document.getElementById('grade').value.trim(),
        class: document.getElementById('class').value.trim(),
        number: document.getElementById('number').value.trim(),
        name: document.getElementById('name').value.trim()
    };

    // í•™ìƒì˜ ê¸€ì„ ë¬¸ë‹¨ë³„ë¡œ ë‚˜ëˆ„ê³  ë²ˆí˜¸ë¥¼ ë§¤ê¸°ëŠ” ì½”ë“œ
   const paragraphs = essayData.content.split(/\n+/).filter(p => p.trim());
   const numberedParagraphs = paragraphs.map((p, index) => `[${index + 1}ë¬¸ë‹¨]\n${p}`).join('\n\n');

    // í”„ë¡¬í”„íŠ¸ë¥¼ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ êµ¬ì„±
    const prompt = `ì•„ë˜ ì œì‹œëœ ì œëª©ê³¼ ë‚´ìš©ì„ ì´ˆë“±í•™êµ 5í•™ë…„ í•™ìƒì˜ ìˆ˜ì¤€ì—ì„œ ìì„¸í•˜ê²Œ ë¶„ì„í•´. í•™ìƒì´ ì œì•ˆ ë‚´ìš©ì„ ë³´ê³  ì‰½ê²Œ ê³ ì¹  ìˆ˜ ìˆë„ë¡ ì œì‹œí•´ì£¼ì„¸ìš”. êµ¬ì²´ì ì¸ ì˜ˆì‹œë¥¼ ë“¤ì–´ê°€ë©° ì„¤ëª…í•´.:

        ì œëª©: "${title}"
        ë‚´ìš©: "${numberedParagraphs}"

        ì°¸ê³ ë¡œ, ìœ„ ë‚´ìš©ì—ì„œ [në¬¸ë‹¨]ìœ¼ë¡œ í‘œì‹œëœ ë¶€ë¶„ì´ í•™ìƒì´ ë‚˜ëˆˆ ë¬¸ë‹¨ì…ë‹ˆë‹¤. ì´ ë¬¸ë‹¨ êµ¬ë¶„ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì—¬ ë¶„ì„í•˜ê³ , ë¬¸ë‹¨ êµ¬ë¶„ì„ ì„ì˜ë¡œ ë³€ê²½í•˜ê±°ë‚˜ ì¬í•´ì„í•˜ì§€ ë§ˆì„¸ìš”.


                              í‰ê°€ ì‹œ ì°¸ê³ ì‚¬í•­:
                              - ë¬¸ë‹¨ êµ¬ë¶„ì´ ì—†ì´ ì‘ì„±ëœ ê²½ìš°, êµ¬ì¡°ì„± ì ìˆ˜ëŠ” **ë°˜ë“œì‹œ D ì´í•˜**ë¡œ í‰ê°€í•  ê²ƒ**
                              - ë¬¸ë‹¨ êµ¬ë¶„ì´ ì—†ëŠ” ê²½ìš°, ì™„ì„±ë„ ì ìˆ˜ë„ **ìµœëŒ€ C**ê¹Œì§€ë§Œ ë¶€ì—¬ ê°€ëŠ¥
                              - ê¸€ì´ ìˆ˜ì •ë³¸ì¸ ê²½ìš°, ì´ì „ ì œì•ˆì‚¬í•­ì´ ì˜ ë°˜ì˜ë˜ì—ˆë‹¤ë©´ ì ìˆ˜ë¥¼ ë†’ê²Œ ì±…ì •
                              - ë¬¸ë‹¨ êµ¬ë¶„ì´ ì˜ ë˜ì–´ ìˆê³  ë‚´ìš©ì´ í†µì¼ì„±ì„ ê°€ì§„ë‹¤ë©´ ì™„ì„±ë„ ì ìˆ˜ë¥¼ ìƒí–¥ ì¡°ì •í•  ê²ƒ
                              - ë¬¸ì¥ì´ ê°„ê²°í•´ì§€ê³  ì´í•´í•˜ê¸° ì‰¬ì›Œì¡Œë‹¤ë©´ í‘œí˜„ì„± ì ìˆ˜ ìƒí–¥
                              - ë¬¸ë‹¨ ê°„ ì—°ê²°ì´ ìì—°ìŠ¤ëŸ¬ì›Œì¡Œë‹¤ë©´ êµ¬ì¡°ì„± ì ìˆ˜ ìƒí–¥
                              - ë…¼ë¦¬ê°€ ë” íƒ„íƒ„í•´ì¡Œë‹¤ë©´ ë…¼ë¦¬ì„± ì ìˆ˜ ìƒí–¥
                              - ì „ì²´ì ì¸ ê¸€ì˜ ì™„ì„±ë„ëŠ” ë¬¸ë‹¨ êµ¬ë¶„ ì—¬ë¶€(ë‚´ìš©ì— ë”°ë¼ ë¬¸ë‹¨ì„ êµ¬ë¶„í–ˆëŠ”ì§€)ë¥¼ ì¤‘ìš”í•˜ê²Œ ë°˜ì˜í•  ê²ƒ

                                                        #ì „ì²´í‰ê°€
                                                        ì´í‰: [ì‰½ê³  ìì„¸í•œ ì„¤ëª…ìœ¼ë¡œ 300ì ì´ë‚´ í‰ê°€]

                                                         #í‰ê°€í•­ëª©
                                                         ë…¼ë¦¬ì„±, êµ¬ì¡°ì„±, í‘œí˜„ì„±, ì™„ì„±ë„ë¥¼ ë‹¤ìŒ í•­ëª©ì— ë§ê²Œ ìì„¸í•˜ê²Œ í‰ê°€í•  ê²ƒ:

                                                         [ë…¼ë¦¬ì„±] (30%)
                                                         ë“±ê¸‰: [A+~F]
                                                         í‰ê°€: [ì¢…í•©ì  í‰ê°€ ë‚´ìš©ì„ ìì„¸í•˜ê³  ì‰½ê²Œ ì„¤ëª…]
                                                         ì˜ëœ ì : [êµ¬ì²´ì  ì˜ˆì‹œì™€ í•¨ê»˜ ì„¤ëª…]
                                                         ê°œì„ ì : [ì–´ë–»ê²Œ í•˜ë©´ ë” ì¢‹ì•„ì§ˆìˆ˜ ìˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…]

                                                         [êµ¬ì¡°ì„±] (25%)
                                                         ë“±ê¸‰: [A+~F]
                                                         í‰ê°€: [ì¢…í•©ì  í‰ê°€ ë‚´ìš©ì„ ìì„¸í•˜ê³  ì‰½ê²Œ ì„¤ëª…]
                                                         ì˜ëœ ì : [êµ¬ì²´ì  ì˜ˆì‹œì™€ í•¨ê»˜ ì„¤ëª…]
                                                         ê°œì„ ì : [ì–´ë–»ê²Œ í•˜ë©´ ë” ì¢‹ì•„ì§ˆìˆ˜ ìˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…]

                                                         [í‘œí˜„ì„±] (25%)
                                                         ë“±ê¸‰: [A+~F]
                                                         í‰ê°€: [ì¢…í•©ì  í‰ê°€ ë‚´ìš©ì„ ìì„¸í•˜ê³  ì‰½ê²Œ ì„¤ëª…]
                                                         ì˜ëœ ì : [êµ¬ì²´ì  ì˜ˆì‹œì™€ í•¨ê»˜ ì„¤ëª…]
                                                         ê°œì„ ì : [ì–´ë–»ê²Œ í•˜ë©´ ë” ì¢‹ì•„ì§ˆìˆ˜ ìˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…]

                                                         [ì™„ì„±ë„] (20%)
                                                         ë“±ê¸‰: [A+~F]
                                                         í‰ê°€: [ì¢…í•©ì  í‰ê°€ ë‚´ìš©ì„ ìì„¸í•˜ê³  ì‰½ê²Œ ì„¤ëª…]
                                                         ì˜ëœ ì : [êµ¬ì²´ì  ì˜ˆì‹œì™€ í•¨ê»˜ ì„¤ëª…]
                                                         ê°œì„ ì : [ì–´ë–»ê²Œ í•˜ë©´ ë” ì¢‹ì•„ì§ˆìˆ˜ ìˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…]

                                                         í‰ê°€ ê¸°ì¤€:
                                                    [ë…¼ë¦¬ì„± í‰ê°€ ê¸°ì¤€] - 30%
                                                    - ì£¼ì¥ì˜ ëª…í™•ì„±: ê¸€ì˜ í•µì‹¬ ì£¼ì¥ì´ ëª…í™•í•œê°€?
                                                    - ê·¼ê±°ì˜ ì ì ˆì„±: ì£¼ì¥ì„ ë’·ë°›ì¹¨í•˜ëŠ” ê·¼ê±°ê°€ ì¶©ë¶„í•œê°€?
                                                    - ì˜ˆì‹œì˜ êµ¬ì²´ì„±: ì ì ˆí•œ ì˜ˆì‹œë¡œ ì„¤ëª…í•˜ê³  ìˆëŠ”ê°€?
                                                    - ë‚´ìš©ì˜ ì¼ê´€ì„±: ì£¼ì¥ì—ì„œ ë²—ì–´ë‚œ ë‚´ìš©ì€ ì—†ëŠ”ê°€?
                                                    - ë…¼ë¦¬ì  íë¦„: ë¬¸ì¥ê³¼ ë¬¸ì¥ì´ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ”ê°€?
                                                    
                                                    [êµ¬ì¡°ì„± í‰ê°€ ê¸°ì¤€] - 25%
                                                    - ë¬¸ë‹¨ êµ¬ë¶„ì˜ ì ì ˆì„±: í•œ ë¬¸ë‹¨ì— í•œ ê°€ì§€ ì¤‘ì‹¬ ë‚´ìš©ì„ ë‹¤ë£¨ëŠ”ê°€?
                                                    - ë¬¸ë‹¨ì˜ ê¸¸ì´: í•œ ë¬¸ë‹¨ì´ 3-5ë¬¸ì¥ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆëŠ”ê°€?
                                                    - ë¬¸ë‹¨ ê°„ ì—°ê²°: ë¬¸ë‹¨ê³¼ ë¬¸ë‹¨ì´ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ”ê°€?
                                                    - ì „ì²´ êµ¬ì¡°: ì‹œì‘-ì¤‘ê°„-ë êµ¬ì¡°ê°€ ì˜ ê°–ì¶°ì ¸ ìˆëŠ”ê°€?
                                                    - ë‚´ìš© ë°°ì—´: ë¹„ìŠ·í•œ ë‚´ìš©ë¼ë¦¬ ì˜ ë¬¶ì—¬ ìˆëŠ”ê°€?
                                                    
                                                    [í‘œí˜„ì„± í‰ê°€ ê¸°ì¤€] - 25%
                                                    - ì–´íœ˜ ì‚¬ìš©: ì´ˆë“±í•™ìƒ ìˆ˜ì¤€ì— ë§ëŠ” ì–´íœ˜ë¥¼ ì‚¬ìš©í–ˆëŠ”ê°€?
                                                    - ë§ì¶¤ë²•: ë§ì¶¤ë²•ê³¼ ë„ì–´ì“°ê¸°ê°€ ì •í™•í•œê°€?
                                                    - ë¬¸ì¥ì˜ ì™„ì„±ë„: ì£¼ì–´ì™€ ì„œìˆ ì–´ê°€ ì˜ ê°–ì¶°ì ¸ ìˆëŠ”ê°€?
                                                    - ë¬¸ì¥ì˜ ë‹¤ì–‘ì„±: ê°™ì€ í‘œí˜„ì´ ë°˜ë³µë˜ì§€ëŠ” ì•ŠëŠ”ê°€?
                                                    - ë¬¸ì¥ì˜ ìì—°ìŠ¤ëŸ¬ì›€: ì½ê¸° ì‰½ê²Œ í‘œí˜„ë˜ì–´ ìˆëŠ”ê°€?
                                                    
                                                    [ì™„ì„±ë„ í‰ê°€ ê¸°ì¤€] - 20%
                                                    - ì „ì²´ì  í†µì¼ì„±: ê¸€ì˜ ì²˜ìŒë¶€í„° ëê¹Œì§€ í•œ ì£¼ì œë¡œ ì¼ê´€ë˜ëŠ”ê°€?
                                                    - ê¸€ì˜ ì™„ê²°ì„±: ê¸€ì´ ìì—°ìŠ¤ëŸ½ê²Œ ë§ˆë¬´ë¦¬ë˜ëŠ”ê°€?
                                                    - ë¶„ëŸ‰ì˜ ì ì ˆì„±: ì£¼ì œë¥¼ ì„¤ëª…í•˜ê¸°ì— ì¶©ë¶„í•œ ë¶„ëŸ‰ì¸ê°€?
                                                    - ë…ì ê³ ë ¤: ì½ëŠ” ì‚¬ëŒì´ ì´í•´í•˜ê¸° ì‰½ê²Œ ì¼ëŠ”ê°€?,
                                                    
                                                       #ì œëª© ë¶„ì„
                                                       í˜„ì¬ ì œëª©: "${essayData.title}"
                                                       ë“±ê¸‰: [A+~F]  
                                                       ë¶„ì„: ì œëª©ì— ëŒ€í•´ ì œëª©ê³¼ ë‚´ìš©ì˜ ì—°ê´€ì„± ë° ëª…í™•ì„±ì„ ê³ ë ¤í•˜ì—¬ ë¶„ì„í•  ê²ƒ.
                                                       ì œì•ˆ: ì œëª©ì´ ë¶€ì¡±í•œ ê²½ìš°ì—ë§Œ ìœ„ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ 2-3ê°œì˜ ëŒ€ì•ˆ ì œëª©ì„ ì œì‹œí•  ê²ƒ.
                                                       [ì œëª© í‰ê°€ ê¸°ì¤€]
                                                       - ì£¼ì œ ë°˜ì˜: ê¸€ì˜ ì£¼ì œê°€ ì œëª©ì— ì˜ ë‚˜íƒ€ë‚˜ëŠ”ê°€?
                                                       - ë‚´ìš© ì—°ê´€ì„±: ì œëª©ê³¼ ë‚´ìš©ì´ ì˜ ì–´ìš¸ë¦¬ëŠ”ê°€?
                                                       - ê¸¸ì´ì™€ í‘œí˜„: ì œëª©ì˜ ê¸¸ì´ì™€ í‘œí˜„ì´ ì ì ˆí•œê°€?,

                                                    #ë¬¸ë‹¨ë¶„ì„
                                                    ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê° ë¬¸ë‹¨ì„ í•˜ë‚˜ì”© ë¶„ì„í•´ì£¼ì„¸ìš”. ë¶„ì„, ì˜ëœ ì , ê°œì„ ì ì„ ì•„ì£¼ ìì„¸í•˜ê³  êµ¬ì²´ì ìœ¼ë¡œ ì œì‹œí•´ì£¼ì„¸ìš”. ê° ë¬¸ë‹¨ì˜ ë¶„ì„ì€ ë‹¤ìŒ í˜•ì‹ì„ ë”°ë¦…ë‹ˆë‹¤:

                                                    [1ë¬¸ë‹¨]
                                                    ì›ë¬¸: [ì—¬ê¸°ì— ë°˜ë“œì‹œ ì›ë¬¸ ì „ì²´ í¬í•¨]
                                                    ë¶„ì„:
                                                    ì˜ëœ ì :
                                                    ê°œì„ ì :
                                                    í‘œí˜„ ê°œì„  ì œì•ˆ: ë¬¸ë‹¨ ë‚´ìš©ì—ì„œ ê³ ì³ì•¼ í•  ë¶€ë¶„ê³¼ í•¨ê»˜ ê·¸ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ìˆ˜ì • ì œì•ˆì„ í•˜ê³  ì´ìœ ë¥¼ ì•Œë ¤ì¤„ ê²ƒ. ì œì•ˆë§ˆë‹¤ ì¤„ì„ ë°”ê¿”ì„œ 2ê°€ì§€ ì´ìƒ ì œì•ˆí•  ê²ƒ. ë§ì¶¤ë²•ì€ ì œì•ˆí•˜ì§€ ì•ŠìŒ.
                                                    ë§ì¶¤ë²• êµì •: ê° ë§ì¶¤ë²• ì˜¤ë¥˜ë¥¼ "[í‹€ë¦° í‘œí˜„] -> [ì˜¬ë°”ë¥¸ í‘œí˜„], [í‹€ë¦° í‘œí˜„]ì€ ì˜ëª»ëœ í‘œí˜„ìœ¼ë¡œ, [ì˜¬ë°”ë¥¸ í‘œí˜„]ì´ ë§ëŠ” í‘œí˜„ì…ë‹ˆë‹¤." í˜•ì‹ìœ¼ë¡œ ì œì‹œí•  ê²ƒ. ì—¬ëŸ¬ ê°œì˜ ë§ì¶¤ë²• ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´ ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì œì‹œ.

                                                    [2ë¬¸ë‹¨]
                                                    ì›ë¬¸: [ì—¬ê¸°ì— ë°˜ë“œì‹œ ì›ë¬¸ ì „ì²´ í¬í•¨]
                                                    ë¶„ì„:
                                                    ì˜ëœ ì :
                                                    ê°œì„ ì :
                                                    í‘œí˜„ ê°œì„  ì œì•ˆ: ë¬¸ë‹¨ ë‚´ìš©ì—ì„œ ê³ ì³ì•¼ í•  ë¶€ë¶„ê³¼ í•¨ê»˜ ê·¸ì— ëŒ€í•œ êµ¬ì²´ì ì¸ ìˆ˜ì • ì œì•ˆì„ í•˜ê³  ì´ìœ ë¥¼ ì•Œë ¤ì¤„ ê²ƒ. ì œì•ˆë§ˆë‹¤ ì¤„ì„ ë°”ê¿”ì„œ 2ê°€ì§€ ì´ìƒ ì œì•ˆí•  ê²ƒ. ë§ì¶¤ë²•ì€ ì œì•ˆí•˜ì§€ ì•ŠìŒ.
                                                    ë§ì¶¤ë²• êµì •: ê° ë§ì¶¤ë²• ì˜¤ë¥˜ë¥¼ "[í‹€ë¦° í‘œí˜„] -> [ì˜¬ë°”ë¥¸ í‘œí˜„], [í‹€ë¦° í‘œí˜„]ì€ ì˜ëª»ëœ í‘œí˜„ìœ¼ë¡œ, [ì˜¬ë°”ë¥¸ í‘œí˜„]ì´ ë§ëŠ” í‘œí˜„ì…ë‹ˆë‹¤." í˜•ì‹ìœ¼ë¡œ ì œì‹œí•  ê²ƒ. ì—¬ëŸ¬ ê°œì˜ ë§ì¶¤ë²• ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´ ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì œì‹œ.

                                                    [ì´í›„ ì‘ì„±ëœ ê¸€ì˜ ëê¹Œì§€ ëª¨ë“  ë¬¸ë‹¨ì— ëŒ€í•´ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ë¶„ì„ ê³„ì†]

                                                         #ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ
                                                         í˜„ì¬ ë¬¸ë‹¨ êµ¬ì¡°:
                                                         - í•™ìƒì˜ ê¸€ì—ì„œ ì–´ë–¤ ë‚´ìš©ë“¤ì„ ì“°ê³  ìˆëŠ”ì§€ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”
                                                         - ë¹„ìŠ·í•œ ë‚´ìš©ë¼ë¦¬ ì–´ë–»ê²Œ ë¬¶ì„ ìˆ˜ ìˆëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì„¸ìš”
                                                         - ê°ê°ì˜ ë‚´ìš©ì´ ê¸€ì˜ ì–´ëŠ ë¶€ë¶„ì— ìˆëŠ”ì§€ ì‹¤ì œ ë¬¸ì¥ì„ ì˜ˆì‹œë¡œ ë“¤ì–´ì£¼ì„¸ìš”

                                                         #ë¬¸ë‹¨ êµ¬ì„± ì œì•ˆ
                                                         í˜„ì¬ ë¬¸ë‹¨ êµ¬ì¡°:
                                                         - ì´ ê¸€ì—ì„œ ë‹¤ë£¨ê³  ìˆëŠ” ì£¼ìš” ë‚´ìš©ì„ ì •ë¦¬í•´ì£¼ì„¸ìš”
                                                         - ë¹„ìŠ·í•œ ë‚´ìš©ë¼ë¦¬ ì–´ë–»ê²Œ ë¬¶ì—¬ìˆëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”
                                                         - í˜„ì¬ ë¬¸ë‹¨êµ¬ì¡°ì— ëŒ€í•´ í‰ê°€í•´ì£¼ì„¸ìš”.

                                                         ë¬¸ë‹¨ êµ¬ì„± ê°œì„ ì•ˆ:
                                                         ê¸€ì˜ ë‚´ìš©ê³¼ ê¸¸ì´ë¥¼ ê³ ë ¤í–ˆì„ ë•Œ, ì´ [3~5]ê°œì˜ ë¬¸ë‹¨ìœ¼ë¡œ ë‚˜ëˆ„ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”.

                                                         1. ì‹œì‘í•˜ëŠ” ë¬¸ë‹¨ì—ì„œëŠ”:
                                                         - ê¸€ì˜ ì£¼ì œë¥¼ ì†Œê°œí•˜ëŠ” ë‚´ìš©: [êµ¬ì²´ì ì¸ ë°©ë²• ë° ë‚´ìš© ì œì•ˆ]
                                                         - ì™œ ì´ ì£¼ì œë¥¼ ì„ íƒí–ˆëŠ”ì§€ ì„¤ëª…: [êµ¬ì²´ì ì¸ ë°©ë²• ë° ë‚´ìš© ì œì•ˆ]
                                                         - ì‹¤ì œ ê¸€ì—ì„œ ì‚¬ìš©í•  ë¬¸ì¥: "[í•™ìƒì˜ ê¸€ì—ì„œ ë°œì·Œí•œ ë¬¸ì¥]"

                                                         2. ì¤‘ê°„ ë¬¸ë‹¨(ë“¤)ì—ì„œëŠ”:
                                                         - [ëª‡ ê°œì˜ ì¤‘ê°„ ë¬¸ë‹¨ì´ í•„ìš”í•œì§€, ì™œ ê·¸ë ‡ê²Œ ë‚˜ëˆ„ë©´ ì¢‹ì€ì§€ ì„¤ëª…]
                                                         - ê° ë¬¸ë‹¨ë³„ë¡œ ë‹¤ë£° ë‚´ìš©: [êµ¬ì²´ì ì¸ ë°©ë²• ë° ë‚´ìš© ì œì•ˆ]
                                                         - ì‹¤ì œ ê¸€ì—ì„œ ì‚¬ìš©í•  ë¬¸ì¥ë“¤: "[í•™ìƒì˜ ê¸€ì—ì„œ ë°œì·Œí•œ ë¬¸ì¥ë“¤]"

                                                         3. ë§ˆë¬´ë¦¬ ë¬¸ë‹¨ì—ì„œëŠ”:
                                                         - ì „ì²´ ë‚´ìš© ìš”ì•½ ë°©ë²•: [êµ¬ì²´ì ì¸ ë°©ë²• ë° ë‚´ìš© ì œì•ˆ]
                                                         - ê¸€ì„ ì–´ë–»ê²Œ ë§ˆë¬´ë¦¬í•˜ë©´ ì¢‹ì„ì§€: [êµ¬ì²´ì ì¸ ë°©ë²• ë° ë‚´ìš© ì œì•ˆ]
                                                         - ì‹¤ì œ ê¸€ì—ì„œ ì‚¬ìš©í•  ë¬¸ì¥: "[í•™ìƒì˜ ê¸€ì—ì„œ ë°œì·Œí•œ ë¬¸ì¥]"

                                                         êµ¬ì²´ì  ì‹¤í–‰ ë°©ì•ˆ:
                                                         * ê¸€ì„ í¬ê²Œ [ìˆ«ì]ê°œì˜ ë¬¸ë‹¨ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë³´ì„¸ìš”. ê·¸ ì´ìœ ëŠ”: [ì´ìœ  ì„¤ëª…]
                                                         * ê° ë¬¸ë‹¨ì€ ì´ë ‡ê²Œ ì—°ê²°í•˜ë©´ ì¢‹ì•„ìš”: [êµ¬ì²´ì ì¸ ì—°ê²° ë°©ë²•]
                                                         * ìƒˆë¡œìš´ ë¬¸ë‹¨ì„ ì‹œì‘í•  ë•ŒëŠ” í•œ ì¤„ì„ ë„ìš°ê³ , 'ê·¸ë¦¬ê³ ', 'í•˜ì§€ë§Œ'ê³¼ ê°™ì€ ì—°ê²°í•˜ëŠ” ë§ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ë³´ì„¸ìš”
                                                         * í•œ ë¬¸ë‹¨ì—ëŠ” ë„ˆë¬´ ë§ì€ ë‚´ìš©ì„ ë„£ì§€ ë§ê³ , ë¹„ìŠ·í•œ ë‚´ìš©ë¼ë¦¬ ëª¨ì•„ì„œ ì¨ë³´ì„¸ìš”`;

    try {
        const response = await fetch('/api/analyze', {  // URL ê²½ë¡œ ìˆ˜ì •
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({ prompt })
});

        if (!response.ok) {
            throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
        }

        const data = await response.json();
        displayAnalysis(data.choices[0].message.content, essayData);
    } catch (error) {
        console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
        alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ë¶„ì„í•˜ê¸°';
    }
});
                                    });

                                </script>
                                        </body>
                                        </html>
